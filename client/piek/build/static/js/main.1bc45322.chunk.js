(this.webpackJsonppiek=this.webpackJsonppiek||[]).push([[0],{119:function(e,t,n){e.exports={attendanceLayout:"attendance_attendanceLayout__3ZkJT",tableWrapper:"attendance_tableWrapper__32pvV",attendanceTable:"attendance_attendanceTable__36c11",interval:"attendance_interval__3CNBY","status-101":"attendance_status-101__3aCi6",tableSearchInput:"attendance_tableSearchInput__hHxoD",tableFooter:"attendance_tableFooter__3W2nf"}},130:function(e,t,n){e.exports={inputWrapper:"archive_inputWrapper__3nHE2",archiveTable:"archive_archiveTable__1BwU5",previewHeading:"archive_previewHeading__1p_gd"}},153:function(e,t,n){e.exports={tableSearchInput:"search_tableSearchInput__mHzTe",filter:"search_filter__1BI6Q",filterPlaceholder:"search_filterPlaceholder__2NcNB",filterIndicator:"search_filterIndicator__Rfc0e",circle:"search_circle__2PIMx",pulsate:"search_pulsate__pgEiY"}},154:function(e,t,n){e.exports={actionsWrapper:"OrderItemActions_actionsWrapper__1mryM",deleteButton:"OrderItemActions_deleteButton__14fyW",moreVertIcon:"OrderItemActions_moreVertIcon__3Qdex",inputListItem:"OrderItemActions_inputListItem__22HbZ"}},172:function(e,t,n){e.exports={heading:"recently_heading__2gRdv",recentlyTable:"recently_recentlyTable__3NJpR"}},200:function(e,t,n){e.exports={checkbox:"shipment_checkbox__2pwPK",btn:"shipment_btn__3E_o1"}},202:function(e,t,n){e.exports={themeToggleButtons:"SettingsDrawer_themeToggleButtons__hIzSP",user:"SettingsDrawer_user__3iVNA",logoutButton:"SettingsDrawer_logoutButton__2_Id_"}},353:function(e,t,n){e.exports={preOrdersTableWrapper:"preorders_preOrdersTableWrapper__2ELAZ"}},360:function(e,t,n){e.exports={unitInput:"CheckList_unitInput__JnH-b"}},404:function(e,t){},406:function(e,t){},421:function(e,t){},423:function(e,t){},451:function(e,t){},453:function(e,t){},454:function(e,t){},459:function(e,t){},461:function(e,t){},467:function(e,t){},469:function(e,t){},488:function(e,t){},500:function(e,t){},503:function(e,t){},540:function(e,t,n){},550:function(e,t,n){},61:function(e,t,n){e.exports={OrderListLayout:"main_OrderListLayout__3KzFa",tableWrapper:"main_tableWrapper__3lHmG",tableSearchInput:"main_tableSearchInput__3VMNw","action-icon":"main_action-icon__1owGu",tableFooter:"main_tableFooter__1Egk2",tableMain:"main_tableMain__GJwKh",awaitingDispatch:"main_awaitingDispatch__ZF9uh",unpaidOrder:"main_unpaidOrder__22HJx",customerTableInfo:"main_customerTableInfo__JKJM7"}},612:function(e,t,n){},614:function(e,t,n){},617:function(e,t,n){},618:function(e,t,n){},619:function(e,t,n){},620:function(e,t,n){},638:function(e,t,n){},639:function(e,t,n){},640:function(e,t,n){},650:function(e,t,n){"use strict";n.r(t),n.d(t,"Context",(function(){return pa}));var a=n(11),r=n(7),c=n(25),i=n.n(c),s=n(42),o=n(0),u=n(35),l=n.n(u),d=n(348),b=n.n(d),j=n(365),m=n(46),p=n(12),O=n(1),h=["component"],f=function(e){var t=e.component,n=Object(r.a)(e,h),c=Object(o.useContext)(pa).store,u=Object(o.useState)(!1),l=Object(p.a)(u,2),d=l[0],b=l[1],j=Object(o.useState)(c.inMemoryToken),f=Object(p.a)(j,2),v=f[0],x=f[1];function g(){return(g=Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c.checkAuth().then((function(e){x(e),b(!0)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(o.useEffect)((function(){v?b(!0):function(){g.apply(this,arguments)}()}),[]),Object(O.jsx)(m.b,Object(a.a)(Object(a.a)({},n),{},{render:function(e){if(d)return v?Object(O.jsx)(t,Object(a.a)({},e)):Object(O.jsx)(m.a,{to:"/login"})}}))},v=n(188),x=n.n(v),g=n(765),I=n(728),D=(n(540),n(541),function(){var e=Object(o.useState)(""),t=Object(p.a)(e,2),n=t[0],a=t[1],r=Object(o.useState)(""),c=Object(p.a)(r,2),u=c[0],l=c[1],d=Object(o.useContext)(pa).store,b=Object(m.g)(),j=function(){var e=Object(s.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.login(n,u);case 2:200===(null===(t=e.sent)||void 0===t?void 0:t.status)?b.push("/"):(console.error("Invalig email or password"),a="warning",r="Unauthorized error",c="Invalig email or password",v.store.addNotification({title:r,message:c,type:a,insert:"bottom",container:"top-right",dismiss:{duration:4e3}}));case 4:case"end":return e.stop()}var a,r,c}),e)})));return function(){return e.apply(this,arguments)}}();return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(x.a,{}),Object(O.jsxs)("div",{className:"loginCard",children:[Object(O.jsx)(g.a,{className:"loginInput",label:"Email",onChange:function(e){return a(e.target.value.trim())}}),Object(O.jsx)(g.a,{label:"Password",type:"password",className:"loginInput",onChange:function(e){return l(e.target.value.trim())}}),Object(O.jsx)(I.a,{className:"Button",variant:"outlined",width:"300px",onClick:j,children:"\u0412\u043e\u0439\u0442\u0438"})]})]})}),y=n(8);function _(e,t){switch(t.type){case"orders":case"preOrders":case"selectedTab":case"searchKeyword":case"managerFilter":return Object(a.a)(Object(a.a)({},e),{},Object(y.a)({},t.type,t.payload));case"resetFilters":return Object(a.a)(Object(a.a)({},e),{},{searchKeyword:"",managerFilter:0});default:return Object(a.a)({},e)}}var C,N,w=n(17),k=n(24),M=n(19),S=n(18),T=Object(S.a)(C||(C=Object(M.a)(["\nsubscription{\n    erp_Orders(where: {OrderStatusID: {_neq: 3} }) {\n      OrderID\n      Entity\n      InvoiceNumber\n      City\n      ShippingDate\n      AcceptanceDate\n      PaidAmount\n      TotalAmount\n      AwaitingDispatch\n      CreatingDate\n      ManagerID\n      OrderStatus {\n        Name\n        ID\n      }\n      OrderItems(order_by: {OrderItemID: asc}){\n        Quantity\n        OrderItemID\n        Name\n        OrderID\n      } \n      User {\n        FirstName\n        LastName\n      }\n\n    }  \n  }\n"]))),L=Object(S.a)(N||(N=Object(M.a)(["\nquery getUsers {\n  erp_Users{\n    FirstName\n    LastName\n    UserID\n    AccessLevelID\n  }\n}\n"]))),F=n(757),$=n(762),A=n(734),P=n(61),U=n.n(P),H=n(36),E=n(55),q=n(54),B=n.n(q),Y=[{Header:"",id:"index",accessor:function(e,t){return t+1}},{Header:"\u041d\u0430\u0438\u043c.",id:"orderItems",accessor:function(e){return 0===e.OrderItems.length?Object(O.jsx)(E.b,{to:"/orders/".concat(e.OrderID),children:Object(O.jsx)("div",{children:"\u041d\u0435\u0442 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0433\u043e"})}):Object(O.jsx)(E.b,{to:"/orders/".concat(e.OrderID),children:e.OrderItems.map((function(e){return Object(O.jsx)("div",{children:Object(O.jsx)("span",{children:e.Name})},e.OrderItemID)}))})}},{Header:"\u041a\u043e\u043b-\u0432\u043e",accessor:function(e){return e.OrderItems.map((function(e){return Object(O.jsx)("div",{children:Object(O.jsx)("div",{children:e.Quantity})},e.OrderItemID)}))}},{Header:"\u041e\u0442\u0433\u0440\u0443\u0437\u043a\u0430",accessor:function(e){return Object(O.jsxs)(O.Fragment,{children:[" ",e.ShippingDate&&B()(e.ShippingDate).format("DD.MM.YY")," "]})}},{Header:"\u041a\u043e\u043c\u043f\u0430\u043d\u0438\u044f / \u0433\u043e\u0440\u043e\u0434",accessor:function(e){return Object(O.jsxs)("div",{className:U.a.customerTableInfo,children:[Object(O.jsx)("div",{children:e.Entity}),Object(O.jsx)("div",{children:e.City})]})}},{Header:"\u0421\u0447\u0435\u0442- \u043e\u043f\u043b\u0430\u0442\u0430",accessor:function(e){return e.InvoiceNumber+(t=e.TotalAmount,n=e.PaidAmount,t&&n?" - "+(n/t*100).toFixed(0)+"%":" - 0%");var t,n}},{Header:"\u041c\u0434\u0436.",accessor:function(e){var t;return Object(O.jsxs)(O.Fragment,{children:[" ",(null===(t=e.User)||void 0===t?void 0:t.FirstName[0])||""," "]})}}],R=n(145);function Q(e){var t=e.columns,n=e.data,r=e.className,c=Object(R.useTable)({columns:t,data:n}),i=c.getTableProps,s=c.getTableBodyProps,o=c.headerGroups,u=c.rows,l=c.prepareRow;return 0===n.length?null:Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("table",Object(a.a)(Object(a.a)({className:"".concat(U.a.tableMain," ").concat(r)},i()),{},{children:[Object(O.jsx)("thead",{children:o.map((function(e,t){return Object(O.jsx)("tr",Object(a.a)(Object(a.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e,t){return Object(O.jsx)("th",Object(a.a)(Object(a.a)({},e.getHeaderProps()),{},{children:e.render("Header")}))}))}),t)}))}),Object(O.jsx)("tbody",Object(a.a)(Object(a.a)({},s()),{},{children:u.map((function(e,t){l(e);var n=e.original.AwaitingDispatch;return Object(O.jsx)("tr",Object(a.a)(Object(a.a)({className:n?U.a.awaitingDispatch:""},e.getRowProps()),{},{children:e.cells.map((function(e,t){return Object(O.jsx)("td",Object(a.a)(Object(a.a)({},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}))]}))})}var W=n(730),K=n(153),z=n.n(K),V=n(725),J=n(764),G=n(778),Z=n(729),X=Object(Z.a)((function(e){return{formControl:{minWidth:70,borderRadius:"var(--br10)",border:"1px solid var(--border)",padding:"0 10px"},select:{fontSize:".8rem",color:"var(--highContrast)"},menuItem:{fontSize:".8rem",color:"var(--lowContrast)"}}})),ee=function(e){var t=e.state,n=e.dispatch,a=e.users,r=X();return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("div",{className:z.a.tableSearchInput,children:[Object(O.jsx)(W.a,{}),Object(O.jsx)("input",{type:"text",placeholder:"\u041d\u043e\u043c\u0435\u0440 \u0441\u0447\u0435\u0442\u0430 \u0438\u043b\u0438 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f",onChange:function(e){n({type:"searchKeyword",payload:e.target.value})},autoFocus:!0,defaultValue:t.searchKeyword}),a&&Object(O.jsxs)("div",{className:z.a.filter,children:[Object(O.jsx)("span",{className:z.a.filterPlaceholder,children:"manager"}),Object(O.jsx)(V.a,{className:r.formControl,children:Object(O.jsxs)(J.a,{name:"managerFilter",value:t.managerFilter,onChange:function(e){n({type:"managerFilter",payload:e.target.value})},className:r.select,disableUnderline:!0,children:[Object(O.jsx)(G.a,{value:0,className:r.menuItem,children:"\u0412\u0441\u0435"}),a.map((function(e){return Object(O.jsxs)(G.a,{className:r.menuItem,value:e.UserID,children:[" ","".concat(e.FirstName," ").concat(e.LastName)," "]},e.UserID)}))]})})]})]}),function(){if(0!==t.managerFilter)return Object(O.jsxs)("div",{className:z.a.filterIndicator,children:[Object(O.jsx)("div",{className:z.a.circle}),Object(O.jsx)("p",{children:"\u0412\u044b\u0434\u0430\u0447\u0430 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0430 \u0444\u0438\u043b\u044c\u0442\u0440\u043e\u043c"})]})}(t.managerFilter)]})};function te(e){for(var t=!1,n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];return a.map((function(n){n&&n.toLowerCase().includes(e.toLowerCase())&&(t=!0)})),!!t}var ne,ae,re,ce,ie=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=[];if(a=""!==t?e.filter((function(e){return te(t,e.InvoiceNumber,e.Entity)})):e,0!==n){var r=[];return a.map((function(e){e.ManagerID===n&&r.push(e)})),r}return a},se=Object(S.b)(ne||(ne=Object(M.a)(["\n    mutation MyMutation($OrderID: Int!, $AcceptanceDate: timestamptz!){\n    update_erp_Orders_by_pk(\n      pk_columns: {OrderID: $OrderID},\n       _set: {\n         OrderStatusID: 2,\n         AcceptanceDate: $AcceptanceDate,\n         }\n      ) {\n        OrderID\n    }\n  }\n\n"]))),oe=n(731),ue=n(353),le=n.n(ue),de=function(e){var t=e.state,n=e.dispatch,a=t.preOrders,r=Object(k.useMutation)(se),c=Object(p.a)(r,1)[0],i=function(e){a.splice(a.indexOf(e),1),n({type:"preOrders",payload:a}),c({variables:{OrderID:e.OrderID,AcceptanceDate:(new Date).toLocaleString("en-US",{timeZone:"Europe/Moscow"})}})},s=Object(H.a)(Y),o=ie(a,t.searchKeyword);return s.push({Header:" ",accessor:function(e){return Object(O.jsx)("div",{onClick:function(){return i(e)},className:"square-button",children:Object(O.jsx)(oe.a,{})})}}),Object(O.jsxs)("div",{className:"".concat(U.a.tableWrapper," ").concat(le.a.preOrdersTableWrapper),children:[Object(O.jsx)(ee,{state:t,dispatch:n}),o&&Object(O.jsx)(Q,{columns:s,data:o})]})},be=function(e){var t=e.users,n=e.state,a=e.dispatch,r=Object(o.useMemo)((function(){return Y}),[]),c=n.orders.sort((function(e,t){return new Date(e.ShippingDate)-new Date(t.ShippingDate)})),i=ie(c,n.searchKeyword,n.managerFilter);return Object(O.jsxs)("div",{className:U.a.tableWrapper,children:[t&&Object(O.jsx)(ee,{state:n,dispatch:a,users:t.filter((function(e){return[1,2].includes(null===e||void 0===e?void 0:e.AccessLevelID)}))}),i&&Object(O.jsx)(Q,{columns:r,data:i})]})},je=n(355),me=n(172),pe=n.n(me),Oe=function(e){var t=e.state,n=(e.dispatch,function(e){var t,n=[{name:"\u0421\u0435\u0433\u043e\u0434\u043d\u044f",date:B()().subtract(0,"day").format("YYYY-MM-DD"),objs:[]},{name:"\u0412\u0447\u0435\u0440\u0430",date:B()().subtract(1,"day").format("YYYY-MM-DD"),objs:[]},{name:"",objs:[]}],a=Object(je.a)(e);try{for(a.s();!(t=a.n()).done;){var r,c=t.value,i=null===(r=c.AcceptanceDate)||void 0===r?void 0:r.split("T")[0];i===n[0].date?n[0].objs.push(c):i===n[1].date?n[1].objs.push(c):n[2].objs.push(c)}}catch(s){a.e(s)}finally{a.f()}return n}(t.orders.sort((function(e,t){return new Date(t.AcceptanceDate)-new Date(e.AcceptanceDate)})))),a=Object(o.useMemo)((function(){return Y}),[]);ie(n[2].objs,t.searchKeyword);return Object(O.jsxs)("div",{children:[n[0].objs.length?Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("div",{className:pe.a.heading,children:"\u0421\u0435\u0433\u043e\u0434\u043d\u044f"}),Object(O.jsx)(Q,{columns:a,data:n[0].objs,className:pe.a.recentlyTable})]}):null,n[1].objs.length?Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("div",{className:pe.a.heading,children:"\u0412\u0447\u0435\u0440\u0430"}),Object(O.jsx)(Q,{columns:a,data:n[1].objs,className:pe.a.recentlyTable})]}):null]})},he=Object(S.b)(ae||(ae=Object(M.a)(["\nmutation MyMutation($managerID: Int!, $orderStatusID: Int!, $isReclamation: Boolean!) {\n  insert_erp_Orders(objects: {ManagerID: $managerID, OrderStatusID:  $orderStatusID, IsReclamation: $isReclamation}) {\n    returning {\n      OrderID\n    }\n  }\n}\n"]))),fe=n(732),ve=n(733),xe=function(e){var t=Object(k.useMutation)(he,{variables:{managerID:e.userID,orderStatusID:1,isReclamation:!1}}),n=Object(p.a)(t,1)[0],a=function(){n().then((function(t){e.history.push("/orders/".concat(t.data.insert_erp_Orders.returning[0].OrderID,"?edit=true"))}))},r=function(){e.setEditState(!e.editState)};return Object(O.jsxs)("div",{className:"action-block noprint",children:[function(){if(e.createOrder)return Object(O.jsx)("div",{"data-for":"global","data-tip":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c",onClick:a,className:"action-icon",children:Object(O.jsx)(ve.a,{})})}(),function(){if(2===e.accessLevel){return Object(O.jsx)("div",{"data-for":"global","data-tip":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c",className:e.editState?"action-icon active":"action-icon",onClick:r,children:Object(O.jsx)(fe.a,{})})}}()]})},ge=Object(S.b)(re||(re=Object(M.a)(["\n  query ($keyword: String!){\n  erp_Orders(where: {\n    _or: [\n      { Entity: {_ilike: $keyword} }, \n      { InvoiceNumber: {_ilike: $keyword} }\n\n      ],\n    OrderStatusID: {_eq: 3}\n    }) {\n      ActualShippingDate\n      AwaitingDispatch\n      OrderID\n      Entity\n      InvoiceNumber\n      City\n      ShippingDate\n      PaidAmount\n      TotalAmount\n      CreatingDate\n      ManagerID\n      OrderItems {\n        Quantity\n        OrderItemID\n        Name\n      } \n      User {\n        FirstName\n      }\n  }\n}\n"]))),Ie=n(375),De=n(130),ye=n.n(De);function _e(e){var t=e.columns,n=e.data,r=e.className,c=Object(R.useTable)({columns:t,data:n}),i=c.getTableProps,s=c.getTableBodyProps,o=c.headerGroups,u=c.rows,l=c.prepareRow;return 0===n.length?"-> \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e":Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("table",Object(a.a)(Object(a.a)({className:"".concat(U.a.tableMain," ").concat(r)},i()),{},{children:[Object(O.jsx)("thead",{children:o.map((function(e,t){return Object(O.jsx)("tr",Object(a.a)(Object(a.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e,t){return Object(O.jsx)("th",Object(a.a)(Object(a.a)({},e.getHeaderProps()),{},{children:e.render("Header")}))}))}),t)}))}),Object(O.jsx)("tbody",Object(a.a)(Object(a.a)({},s()),{},{children:u.map((function(e,t){l(e);var n=e.original.unpaid;return Object(O.jsx)("tr",Object(a.a)(Object(a.a)({className:n?U.a.unpaidOrder:""},e.getRowProps()),{},{children:e.cells.map((function(e,t){return Object(O.jsx)("td",Object(a.a)(Object(a.a)({},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}))]}))})}var Ce,Ne,we=Object(S.b)(ce||(ce=Object(M.a)(["\nquery{\n  erp_Orders(\n    where: {OrderStatusID: {_eq: 3}},\n    order_by: {OrderID: desc},\n    limit: 1000,\n    ){\n\t\tOrderID\n    PaidAmount\n    TotalAmount\n  }\n}\n"]))),ke=Object(S.b)(Ce||(Ce=Object(M.a)(["\nquery($limit: Int!){\n  erp_Orders(\n    where: { OrderStatusID: {_eq: 3} } \n    limit: $limit\n    ){\n    ActualShippingDate\n    AwaitingDispatch\n    OrderID\n    Entity\n    InvoiceNumber\n    City\n    ShippingDate\n    PaidAmount\n    TotalAmount\n    CreatingDate\n    ManagerID\n    OrderItems {\n      Quantity\n      OrderItemID\n      Name\n    } \n    User {\n      FirstName\n    }\n  }\n}\n"]))),Me=Object(S.b)(Ne||(Ne=Object(M.a)(["\nquery MyQuery($unpaidIDs: [Int!]) {\n    erp_Orders(where: { OrderStatusID: {_eq: 3}, OrderID: {_in: $unpaidIDs } } ) {\n      OrderID\n      Entity\n      InvoiceNumber\n      City\n      ShippingDate\n      PaidAmount\n      TotalAmount\n      AwaitingDispatch\n      ActualShippingDate\n      CreatingDate\n      ManagerID\n      OrderItems {\n        Quantity\n        OrderItemID\n        Name\n      } \n      User {\n        FirstName\n      }\n    }\n  }\n"]))),Se=function(e){var t=e.state,n=e.dispatch,r=e.columns,c=Object(k.useQuery)(ke,{variables:{limit:10}}).data,i=void 0===c?[]:c;Object(k.useQuery)(we,{onCompleted:function(e){n({type:"unpaidIDs",payload:e.erp_Orders.filter((function(e){return e.PaidAmount/e.TotalAmount<.999})).map((function(e){return e.OrderID}))})}});var s=Object(k.useQuery)(Me,{variables:{unpaidIDs:t.unpaidIDs}}).data,o=void 0===s?[]:s;return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("p",{className:ye.a.previewHeading,children:"\u041d\u0435\u0434\u0430\u0432\u043d\u043e \u043e\u0442\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u044b\u0435"}),Object(O.jsx)(_e,{columns:r,data:o.erp_Orders&&i.erp_Orders?[].concat(Object(H.a)(o.erp_Orders.map((function(e){return Object(a.a)(Object(a.a)({},e),{},{unpaid:!0})}))),Object(H.a)(i.erp_Orders.filter((function(e){return!t.unpaidIDs.includes(e.OrderID)})).sort((function(e,t){return new Date(t.ActualShippingDate)-new Date(e.ActualShippingDate)})))):[],className:ye.a.archiveTable})]})};function Te(e,t){switch(t.type){case"searchKeyword":case"unpaidIDs":return Object(a.a)(Object(a.a)({},e),{},Object(y.a)({},t.type,t.payload));default:return Object(a.a)({},e)}}var Le,Fe,$e,Ae,Pe,Ue,He,Ee=function(){var e=Object(o.useReducer)(Te,{unpaidIDs:[],searchKeyword:""}),t=Object(p.a)(e,2),n=t[0],a=t[1],r=Object(k.useQuery)(ge,{variables:{keyword:"%"+n.searchKeyword+"%"}}).data,c=void 0===r?[]:r,i=Object(o.useMemo)((function(){return Y}),[]);return Object(O.jsxs)("div",{children:[Object(O.jsx)(Ie.a,{className:ye.a.inputWrapper,autoFocus:!0,onChange:function(e){setTimeout((function(){a({type:"searchKeyword",payload:e.target.value})}),400)},placeholder:"\u043d\u043e\u043c\u0435\u0440 \u0441\u0447\u0435\u0442\u0430 \u0438\u043b\u0438 \u044e\u0440\u043b\u0438\u0446\u043e"}),!n.searchKeyword&&Object(O.jsx)(Se,{state:n,dispatch:a,columns:i}),n.searchKeyword&&c.erp_Orders&&Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("p",{className:ye.a.previewHeading,children:"\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u043f\u043e\u0438\u0441\u043a\u0430 \u043f\u043e \u0430\u0440\u0445\u0438\u0432\u0443"}),Object(O.jsx)(_e,{columns:i,data:c.erp_Orders,className:ye.a.archiveTable})]})]})},qe=["children","value","index"],Be=function(e){var t=Object(o.useContext)(pa).store,n=Object(o.useReducer)(_,function(e,t,n){return{orders:t||[],preOrders:n||[],selectedTab:e,searchKeyword:"",managerFilter:0}}(t.priorityTab,t.cachedOrders,t.cachedPreOrders)),c=Object(p.a)(n,2),i=c[0],s=c[1],u=i.selectedTab,l=Object(m.g)();Object(k.useSubscription)(T,{onSubscriptionData:function(e){e.subscriptionData.data.erp_Orders.sort((function(e,t){return new Date(e.ShippingDate)-new Date(t.ShippingDate)}));var n=[],a=[];e.subscriptionData.data.erp_Orders.forEach((function(e){1===e.OrderStatus.ID?a.push(e):2===e.OrderStatus.ID&&n.push(e)})),t.setCachedOrders(n),t.setCachedPreOrders(a),s({type:"preOrders",payload:a}),s({type:"orders",payload:n})},fetchPolicy:"cache-first",nextFetchPolicy:"cache-first"});var d=Object(k.useQuery)(L).data,b=void 0===d?[]:d;function j(e){var t=e.children,n=e.value,c=e.index,i=Object(r.a)(e,qe);return Object(O.jsx)("div",Object(a.a)(Object(a.a)({role:"tabpanel",hidden:n!==c,id:"simple-tabpanel-".concat(c),"aria-labelledby":"simple-tab-".concat(c)},i),{},{children:n===c&&Object(O.jsx)(F.a,{children:t})}))}function h(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}var f="50px",v=Object(w.a)({root:{borderBottom:"1px solid var(--border)",minHeight:f,height:f,marginBottom:"2rem",backgroundColor:"var(--L0)"},indicator:{display:"none"}})($.a),x=Object(w.a)((function(e){return{root:{minWidth:"10%",fontSize:".9rem",textTransform:"none",color:"var(--lowContrast)",borderRight:"1px solid var(--border)",padding:0,opacity:1,fontWeight:500,minHeight:f,height:f,transition:"color .3s ease","&:hover":{color:"var(--highContrast)"},"&$selected":{backgroundColor:"var(--L1)"}},selected:{}}}))((function(e){return Object(O.jsx)(A.a,Object(a.a)({disableRipple:!0},e))}));return Object(O.jsxs)("div",{className:U.a.OrderListLayout,children:[Object(O.jsxs)(v,{value:u,onChange:function(e,n){s({type:"selectedTab",payload:n}),s({type:"resetFilters"}),t.setPriorutyTab(n)},"aria-label":"simple tabs example",className:"orderListLayoutTabs",children:[Object(O.jsx)(x,Object(a.a)({label:"\u041f\u0440\u0435\u0434\u0437\u0430\u043a\u0430\u0437\u044b"},h(0))),Object(O.jsx)(x,Object(a.a)({label:"\u041e\u0447\u0435\u0440\u0435\u0434\u043e\u0441\u0442\u044c"},h(1))),Object(O.jsx)(x,Object(a.a)({label:"\u041d\u0435\u0434\u0430\u0432\u043d\u0438\u0435"},h(2))),Object(O.jsx)(x,Object(a.a)({label:"\u0410\u0440\u0445\u0438\u0432"},h(3))),Object(O.jsx)(xe,{createOrder:1,userID:t.user.UserID,history:l})]}),Object(O.jsx)(j,{value:u,index:0,children:Object(O.jsx)(de,{state:i,dispatch:s})}),Object(O.jsx)(j,{value:u,index:1,children:Object(O.jsx)(be,{state:i,dispatch:s,users:b.erp_Users})}),Object(O.jsx)(j,{value:u,index:2,children:Object(O.jsx)(Oe,{state:i,dispatch:s})}),Object(O.jsx)(j,{value:u,index:3,children:Object(O.jsx)(Ee,{state:i,dispatch:s})})]})},Ye=n(369),Re=Object(S.a)(Le||(Le=Object(M.a)(["\nquery MyQuery($OrderID: Int!) {\n  erp_Orders(\n    where: {OrderID: {_eq: $OrderID}}\n    ){\n    AwaitingDispatch\n    ActualShippingDate\n    AcceptanceDate\n    OrderID\n    ManagerID\n    OrderStatusID\n    City\n    ShippingDate\n    CreatingDate\n    Comment\n    Entity\n    InvoiceNumber\n    OrderNumber\n    PaidAmount\n    TotalAmount\n    User {\n      FirstName\n      LastName\n      UserID\n    }\n    OrderItems(order_by: {OrderItemID: asc}) {\n      Fitter\n      Name\n      FullName\n      OrderItemID\n      OrderID\n      Quantity\n      SerialNumber\n    }\n    CheckListUnits(order_by: {CheckListUnitID: desc}) {\n      CheckListUnitID\n      OrderID\n      IsComplited\n      Point\n    }\n    Docs {\n      Key\n      FileName\n    }\n    PaymentHistories(\n      where: {PaidAmount: {_neq: 0}}\n    ){\n      PaidAmount\n      Date\n    }\n  }\n}\n"]))),Qe=Object(S.b)(Fe||(Fe=Object(M.a)(["\nmutation MyMutation($objects: [erp_Docs_insert_input!]!) {\n  insert_erp_Docs(objects: $objects) {\n    returning {\n      ID\n    }\n  }\n}\n"]))),We=Object(S.b)($e||($e=Object(M.a)(["\n    mutation MyMutation($key: String!) {\n    delete_erp_Docs(where: {Key: {_eq: $key} }) {\n        returning {\n        Key\n        }\n    }\n    }\n"]))),Ke=Object(S.b)(Ae||(Ae=Object(M.a)(["\n mutation MyMutation($name: String!, $orderID: Int!, $quantity: Int!, $fullName: String!) {\n  insert_erp_OrderItems_one(object: {\n    OrderID: $orderID,\n    Name: $name,\n    FullName: $fullName,\n    Quantity: $quantity,\n    }) {\n    OrderItemID\n    OrderID\n  }\n}\n"]))),ze=Object(S.b)(Pe||(Pe=Object(M.a)(["\nmutation MyMutation($orderItemID: Int!) {\n  delete_erp_OrderItems_by_pk(OrderItemID: $orderItemID) {\n\t\tOrderItemID\n  }\n}\n"]))),Ve=Object(S.b)(Ue||(Ue=Object(M.a)(["\nmutation($OrderItemID: Int!, $FullName: String!, $Name: String!, $Quantity: Int!) {\n  update_erp_OrderItems_by_pk(\n    pk_columns: {OrderItemID: $OrderItemID},\n    _set: {FullName: $FullName, Name: $Name, Quantity: $Quantity}) {\n    Name\n    FullName\n    OrderItemID\n    Quantity\n  }\n}\n\n"]))),Je=Object(S.b)(He||(He=Object(M.a)(["\nmutation($OrderItemID: Int!, $Fitter: String!, $SerialNumber: String!) {\n  update_erp_OrderItems_by_pk(\n    pk_columns: {OrderItemID: $OrderItemID},\n     _set: {Fitter: $Fitter, SerialNumber: $SerialNumber}\n  ){\n    OrderItemID\n  }\n}\n"]))),Ge=n(89),Ze=n.n(Ge),Xe=n(368),et=n(735),tt=n(154),nt=n.n(tt),at=Object(w.a)((function(e){return{root:{fontSize:".8rem",color:"var(--highContrast)"}}}))((function(e){return Object(O.jsx)(G.a,Object(a.a)({disableRipple:!0},e))})),rt=Object(w.a)((function(e){return{root:{fontSize:".8rem"}}}))((function(e){return Object(O.jsx)(g.a,Object(a.a)({size:"small",variant:"outlined",InputLabelProps:{shrink:!0}},e))})),ct=function(e){var t=e.editState,n=e.item,r=e.editItemHandler,c=e.deleteItemHandler,i=e.updateItem,s=Object(o.useState)(null),u=Object(p.a)(s,2),l=u[0],d=u[1],b=Object(o.useState)({serialNumber:n.SerialNumber,fitter:n.Fitter}),j=Object(p.a)(b,2),m=j[0],h=j[1],f=function(){d(null),n.SerialNumber===m.serialNumber&&n.Fitter===m.fitter||i({variables:{OrderItemID:n.OrderItemID,Fitter:m.fitter,SerialNumber:m.serialNumber.toString()}})};return Object(O.jsxs)("div",{className:"noprint",children:[Object(O.jsx)(I.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){d(e.currentTarget)},size:"small",children:Object(O.jsx)(et.a,{className:nt.a.moreVertIcon})}),Object(O.jsxs)(Xe.a,{id:"simple-menu",anchorEl:l,keepMounted:!0,open:Boolean(l),onClose:f,children:[Object(O.jsx)(at,{className:nt.a.inputListItem,children:Object(O.jsx)(rt,{type:"number",label:"\u0421\u0435\u0440\u0438\u0439\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440",multiline:!0,onChange:function(e){return h((function(t){return Object(a.a)(Object(a.a)({},t),{},{serialNumber:e.target.value})}))},defaultValue:m.serialNumber})}),Object(O.jsx)(at,{className:nt.a.inputListItem,children:Object(O.jsx)(rt,{label:"\u0421\u0431\u043e\u0440\u0449\u0438\u043a",onChange:function(e){return h((function(t){return Object(a.a)(Object(a.a)({},t),{},{fitter:e.target.value})}))},defaultValue:m.fitter})}),t&&Object(O.jsxs)("div",{className:nt.a.actionsWrapper,children:[Object(O.jsx)(at,{onClick:function(e){f(),r(e,n)},children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"}),Object(O.jsx)(at,{className:nt.a.deleteButton,onClick:function(){f(),c(n.OrderItemID)},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]})]})]})},it=Object(w.a)({root:{}})((function(e){return Object(O.jsx)(g.a,Object(a.a)({size:"small",autoComplete:"off",InputProps:{disableUnderline:!0}},e))})),st={name:"",fullName:"",quantity:"",id:null};function ot(e,t){switch(t.type){case"name":case"fullName":case"quantity":return Object(a.a)(Object(a.a)({},e),{},Object(y.a)({},t.type,t.payload));case"reset":return st;case"editItem":return{id:t.payload[0],name:t.payload[1],fullName:t.payload[2],quantity:t.payload[3]};default:return Object(a.a)({},e)}}var ut,lt,dt,bt,jt,mt=function(e){var t=e.data,n=e.editState,a=e.refetch,r=e.orderID,c=Object(k.useMutation)(ze),i=Object(p.a)(c,1)[0],s=Object(k.useMutation)(Ke),u=Object(p.a)(s,1)[0],l=Object(k.useMutation)(Ve),d=Object(p.a)(l,1)[0],b=Object(k.useMutation)(Je),j=Object(p.a)(b,1)[0],m=Object(o.useReducer)(ot,st),h=Object(p.a)(m,2),f=h[0],v=h[1],x=function(e){i({variables:{orderItemID:e}}),a()},g=function(e,t){v({type:"editItem",payload:[t.OrderItemID,t.Name,t.FullName,t.Quantity]})};Object(o.useEffect)((function(){n||""===f.name||""===f.quantity||D()}),[n]);var D=function(){if(""===f.quantity||""===f.name)return null;u({variables:{orderID:r,name:f.name,quantity:parseInt(f.quantity),fullName:f.fullName}}).then((function(){v({type:"reset"}),a()}))},y=function(){if(""===f.quantity||""===f.name)return null;d({variables:{OrderItemID:f.id,Name:f.name,Quantity:parseInt(f.quantity),FullName:f.fullName}}).then((function(){v({type:"reset"}),a()}))};return Object(O.jsxs)(O.Fragment,{children:[t.map((function(e,t){return Object(O.jsxs)("div",{className:Ze.a.Unit,children:[Object(O.jsx)("span",{className:Ze.a.index,children:t+1}),Object(O.jsxs)("div",{className:Ze.a.name,children:[" ",e.Name," "]}),Object(O.jsxs)("span",{className:Ze.a.quantity,children:[" ",e.Quantity]}),Object(O.jsx)(ct,{editState:n,item:e,editItemHandler:g,deleteItemHandler:x,updateItem:j}),Object(O.jsxs)("div",{className:Ze.a.fullName,children:[" ",e.FullName]})]},e.OrderItemID)})),n?Object(O.jsxs)("div",{className:Ze.a.addOrderItem,children:[Object(O.jsx)(it,{label:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",value:f.name,onChange:function(e){return v({type:"name",payload:e.target.value})}}),Object(O.jsx)(it,{label:"\u041f\u043e\u043b\u043d\u043e\u0435 \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",multiline:!0,className:Ze.a.fullNameInput,value:f.fullName,onChange:function(e){return v({type:"fullName",payload:e.target.value})}}),Object(O.jsx)(it,{label:"\u041a\u043e\u043b-\u0432\u043e",type:"number",className:Ze.a.quantityInput,value:f.quantity,onChange:function(e){return v({type:"quantity",payload:e.target.value})}}),f.id?Object(O.jsx)(I.a,{className:Ze.a.pushOrderItemButton,onClick:y,children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"}):Object(O.jsx)(I.a,{className:Ze.a.pushOrderItemButton,onClick:D,children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}):null]})},pt=n(737),Ot=(n(550),n(200)),ht=n.n(Ot),ft=n(173),vt=n(758),xt=n(767),gt=Object(S.b)(ut||(ut=Object(M.a)(["\n mutation MyMutation($orderID: Int!, $fields: erp_Orders_set_input) {\n  update_erp_Orders_by_pk(pk_columns: {OrderID: $orderID}, _set: $fields) {\n\t\tOrderID\n  }\n}\n"]))),It=Object(S.b)(lt||(lt=Object(M.a)(["\n mutation MyMutation($orderID: Int!, $awaitingDispatch: Boolean!) {\n  update_erp_Orders_by_pk(\n    pk_columns: {OrderID: $orderID},\n   _set: { AwaitingDispatch: $awaitingDispatch }\n  ) {\n\t\tOrderID\n    AwaitingDispatch\n  }\n}\n"]))),Dt=Object(S.b)(dt||(dt=Object(M.a)(["\n  mutation MyMutation($OrderID: Int!, $ActualShippingDate: timestamptz!) {\n    update_erp_Orders_by_pk(\n      pk_columns: {OrderID: $OrderID}, \n      _set: {\n        OrderStatusID: 3,\n        AwaitingDispatch: false,\n        ActualShippingDate: $ActualShippingDate,\n        }){\n      OrderID\n      OrderStatusID\n    }\n  }\n"]))),yt=Object(S.b)(bt||(bt=Object(M.a)(["\nmutation MyMutation($OrderID: Int!) {\n  delete_erp_Orders_by_pk(OrderID: $OrderID) {\n    OrderID\n  }\n}\n"]))),_t=function(e){var t=e.data,n=e.orderID,a=Object(o.useState)(!1),r=Object(p.a)(a,2),c=r[0],u=r[1],l=Object(m.g)(),d=Object(k.useMutation)(It),b=Object(p.a)(d,1)[0],j=Object(k.useMutation)(Dt),h=Object(p.a)(j,1)[0],f=Object(k.useMutation)(yt),v=Object(p.a)(f,1)[0];function x(){return(x=Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h({variables:{OrderID:n,ActualShippingDate:new Date}}).then((function(e){3===e.data.update_erp_Orders_by_pk.OrderStatusID&&l.push("/")}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return 3===t.OrderStatusID?null:1===t.OrderStatusID?Object(O.jsx)("div",{children:Object(O.jsx)(ft.a,{onClick:function(){v({variables:{OrderID:n}}).then((function(e){e.data.delete_erp_Orders_by_pk.OrderID&&l.push("/")}))},className:ht.a.btn,appearance:"minimal",children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u0440\u0435\u0434\u0437\u0430\u043a\u0430\u0437"})}):Object(O.jsxs)("div",{children:[Object(O.jsx)(vt.a,{title:"\u041f\u0435\u0440\u0435\u043d\u0435\u0441\u0442\u0438 \u0432 \u0430\u0440\u0445\u0438\u0432?",isShown:c,confirmLabel:"\u041f\u0435\u0440\u0435\u043d\u0435\u0441\u0442\u0438",onConfirm:function(){return x.apply(this,arguments)},cancelLabel:"\u041d\u0435 \u043d\u0443\u0436\u043d\u043e",onCloseComplete:function(){return u(!1)},children:"\u0417\u0430\u043a\u0430\u0437 \u0443\u0434\u0430\u043b\u0438\u0442\u0441\u044f \u0438\u0437 \u043e\u0447\u0435\u0440\u0435\u0434\u043d\u043e\u0441\u0442\u0438, \u043d\u043e \u0435\u0433\u043e \u0432 \u043b\u044e\u0431\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u043c\u043e\u0436\u043d\u043e \u0431\u0443\u0434\u0435\u0442 \u043d\u0430\u0439\u0442\u0438 \u0432 \u0430\u0440\u0445\u0438\u0432\u0435 \u043f\u043e \u043d\u043e\u043c\u0435\u0440\u0443 \u0441\u0447\u0435\u0442\u0430, \u044e\u0440\u043b\u0438\u0446\u0443, \u043c\u0430\u0440\u043a\u0438\u0440\u043e\u0432\u043a\u0435 \u043f\u0440\u0438\u0432\u043e\u0434\u0430."}),Object(O.jsx)(xt.a,{className:ht.a.checkbox,marginTop:0,label:"\u041e\u0436\u0438\u0434\u0430\u0435\u0442 \u043e\u0442\u0433\u0440\u0443\u0437\u043a\u0438",onChange:function(){b({variables:{orderID:n,awaitingDispatch:!t.AwaitingDispatch},optimisticResponse:{erp_Orders:{__typename:"erp_Orders",OrderID:n,AwaitingDispatch:!t.AwaitingDispatch}}})},checked:t.AwaitingDispatch}),Object(O.jsx)(ft.a,{onClick:function(){return u(!0)},className:ht.a.btn,appearance:"primary",children:"\u041e\u0442\u0433\u0440\u0443\u0436\u0435\u043d"})]})},Ct=function(e){var t=e.heading,n=e.secondaryHeading;return Object(O.jsxs)(pt.a,{className:"OrderInfoCard",children:[Object(O.jsxs)("div",{className:"row",children:[Object(O.jsx)("div",{className:"heading",children:t}),Object(O.jsx)("div",{className:"secondaryHeading",children:n})]}),Object(O.jsx)("div",{className:"body",children:e.children})]})},Nt=function(e){var t=e.data,n=function(e,t){return e&&t?" - "+(t/e*100).toFixed(0)+"%":""};[{heading:"\u041f\u043b\u0430\u043d. \u043e\u0442\u0433\u0440\u0443\u0437\u043a\u0430",data:t.ShippingDate&&B()(t.ShippingDate).format("DD.MM.YY"),className:"bold"},{heading:"\u0421\u0447\u0435\u0442 / \u043e\u043f\u043b\u0430\u0442\u0430",data:Object(O.jsxs)("div",{children:[" ","\u2116 "+t.InvoiceNumber+n(t.TotalAmount,t.PaidAmount)]}),className:"bold"},{heading:"\u042e\u0440 \u041b\u0438\u0446\u043e",data:t.Entity},{heading:"\u0413\u043e\u0440\u043e\u0434",data:t.City},{heading:"",data:t.Comment,className:"OrderComment"}].map((function(e){return Object(O.jsxs)("div",{className:e.className,children:[Object(O.jsx)("pre",{children:e.heading}),e.data]},e.heading)}));return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("div",{className:"wrap",children:[Object(O.jsxs)("div",{className:"row",children:[Object(O.jsxs)("div",{className:"bold",children:[Object(O.jsx)("pre",{children:"\u041f\u043b\u0430\u043d. \u043e\u0442\u0433\u0443\u0437\u043a\u0430"}),t.ShippingDate&&B()(t.ShippingDate).format("DD.MM.YY")]}),Object(O.jsxs)("div",{className:"bold",children:[Object(O.jsx)("pre",{children:"\u0421\u0447\u0435\u0442 / \u043e\u043f\u043b\u0430\u0442\u0430"}),"\u2116 "+t.InvoiceNumber+n(t.TotalAmount,t.PaidAmount)]})]}),Object(O.jsx)("div",{className:"OrderComment",children:t.Comment}),function(){var e,n,a=[{heading:"\u041c\u0435\u043d\u0435\u0434\u0436\u0435\u0440",data:"".concat(null===(e=t.User)||void 0===e?void 0:e.FirstName," ").concat((null===(n=t.User)||void 0===n?void 0:n.LastName)||"undefined")},{heading:"\u041d\u043e\u043c\u0435\u0440 \u0437\u0430\u043a\u0430\u0437\u0430",data:t.OrderNumber},{heading:"\u0421\u043e\u0437\u0434\u0430\u043d",data:B()(t.CreatingDat).format("DD.MM.YY")},{heading:"\u0412 \u043e\u0447\u0435\u0440\u0435\u0434\u043d\u043e\u0441\u0442\u0438",data:B()(t.AcceptanceDate).format("DD.MM.YY")},{heading:"\u0424\u0430\u043a\u0442. \u043e\u0442\u0433\u0440\u0443\u0437\u043a\u0430",data:B()(t.ActualShippingDate).format("DD.MM.YY")}];return Object(O.jsx)(Ct,{heading:"\u041e \u0437\u0430\u043a\u0430\u0437\u0435",children:Object(O.jsx)("table",{children:a.map((function(e){return e.data&&"Invalid date"!==e.data?Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{children:e.heading}),Object(O.jsx)("td",{children:e.data})]}):null}))})})}(),0==t.PaymentHistories.length?null:Object(O.jsx)(Ct,{heading:"\u041f\u043b\u0430\u0442\u0435\u0436\u0438",secondaryHeading:"".concat(t.TotalAmount," \u20bd"),children:Object(O.jsx)("table",{className:"paidVisualization",children:t.PaymentHistories.map((function(e){return Object(O.jsxs)("tr",{children:[Object(O.jsxs)("td",{children:[(e.PaidAmount/t.TotalAmount*100).toFixed(0)," % "]}),Object(O.jsx)("td",{children:B()(e.Date).format("DD.MM.YY")})]})}))})})]}),Object(O.jsx)("div",{className:"actions noprint",children:Object(O.jsx)(_t,Object(a.a)({},e))})]})},wt=n(760),kt=(n(612),Object(S.b)(jt||(jt=Object(M.a)(["\n  mutation($PaidAmount: numeric!, $Date: timestamptz!, $OrderID: Int!) {\n    insert_erp_PaymentHistory_one(object: {PaidAmount: $PaidAmount, OrderID: $OrderID, Date: $Date}) {\n      ID\n      OrderID\n    }\n}\n"])))),Mt=n(240),St=["inputRef","onChange"],Tt=["inputRef","onChange"],Lt={};function Ft(e){var t=e.inputRef,n=e.onChange,c=Object(r.a)(e,St);return Object(O.jsx)(Mt.a,Object(a.a)(Object(a.a)({},c),{},{getInputRef:t,onValueChange:function(t){n({target:{name:e.name,value:t.value}})},format:"##.##.##"}))}function $t(e){var t=e.inputRef,n=e.onChange,c=Object(r.a)(e,Tt);return Object(O.jsx)(Mt.a,Object(a.a)(Object(a.a)({},c),{},{getInputRef:t,onValueChange:function(t){n({target:{name:e.name,value:t.value}})},prefix:"\u20bd ",thousandSeparator:!0}))}console.log(Lt);var At,Pt,Ut,Ht,Et,qt,Bt=function(e){var t=e.data,n=e.orderID,r=e.refetch,c=e.users,i=function(e){return Lt[e.target.name]=e.target.value},s=Object(k.useMutation)(gt),u=Object(p.a)(s,1)[0],l=Object(k.useMutation)(kt),d=Object(p.a)(l,1)[0];return Object(o.useEffect)((function(){return Lt={},function(){console.log("doing mutation for order",n,Lt),u({variables:{orderID:n,fields:Lt}}),Lt.PaidAmount&&d({variables:{Date:new Date,OrderID:n,PaidAmount:Lt.PaidAmount}}),r()}}),[]),Object(O.jsx)("form",{className:"Info EditableInfo",children:Object(O.jsxs)("div",{className:"wrap",children:[Object(O.jsx)(g.a,{label:"\u041f\u043b\u0430\u043d. \u043e\u0442\u0433\u0440\u0443\u0437\u043a\u0430",name:"ShippingDate",defaultValue:B()(t.ShippingDate).format("DD.MM.YY"),onChange:function(e){e.target.value=B()(e.target.value,"DD-MM-YY").format("YYYY-MM-DD"),i(e)},placeholder:"dd.mm.yy",autoComplete:"off",InputProps:{inputComponent:Ft}}),Object(O.jsx)(g.a,{label:"\u041d\u043e\u043c\u0435\u0440 \u0441\u0447\u0435\u0442\u0430",type:"number",name:"InvoiceNumber",defaultValue:t.InvoiceNumber,onChange:i}),Object(O.jsx)(g.a,{label:"\u041d\u043e\u043c\u0435\u0440 \u0437\u0430\u043a\u0430\u0437\u0430",type:"number",name:"OrderNumber",defaultValue:t.OrderNumber,onChange:i}),Object(O.jsx)(wt.a,{id:"combo-box-demo",options:c.filter((function(e){return 3!=e.AccessLevelID})),getOptionLabel:function(e){return"".concat(e.FirstName," ").concat(e.LastName)},renderInput:function(e){return Object(O.jsx)(g.a,Object(a.a)(Object(a.a)({},e),{},{label:"\u041c\u0435\u043d\u0435\u0434\u0436\u0435\u0440"}))},defaultValue:function(){return function(e,t){if(!e)return null;var n=e.indexOf(e.find((function(e){return e.UserID===t})));return e[n]}(c,t.ManagerID)},onChange:function(e,t){Lt.ManagerID=(null===t||void 0===t?void 0:t.UserID)||null}}),Object(O.jsx)(g.a,{label:"\u042e\u0440 \u043b\u0438\u0446\u043e",autoComplete:"off",name:"Entity",defaultValue:t.Entity,onChange:i}),Object(O.jsx)(g.a,{label:"\u0413\u043e\u0440\u043e\u0434",autoComplete:"off",name:"City",defaultValue:t.City,onChange:i}),Object(O.jsx)(g.a,{label:"\u0421\u0443\u043c\u043c\u0430 \u0437\u0430\u043a\u0430\u0437\u0430",name:"TotalAmount",defaultValue:t.TotalAmount,autoComplete:"off",onChange:i,InputProps:{inputComponent:$t}}),Object(O.jsx)(g.a,{label:"\u041e\u043f\u043b\u0430\u0447\u0435\u043d\u043e",name:"PaidAmount",defaultValue:t.PaidAmount,autoComplete:"off",onChange:i,InputProps:{inputComponent:$t}}),Object(O.jsx)(g.a,{label:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",multiline:!0,autoComplete:"off",name:"Comment",defaultValue:t.Comment,onChange:i})]})})},Yt=Object(S.b)(At||(At=Object(M.a)(["\nmutation($OrderID: Int!, $Point: String!) {\n  insert_erp_CheckListUnits_one(\n    object: {OrderID: $OrderID, Point: $Point}){\n      CheckListUnitID\n      Point\n      IsComplited\n    }\n}\n"]))),Rt=Object(S.b)(Pt||(Pt=Object(M.a)(["\nmutation MyMutation($CheckListUnitID: Int!, $IsCompluted: Boolean!) {\n  update_erp_CheckListUnits_by_pk(\n    pk_columns: {CheckListUnitID: $CheckListUnitID}, _set: {IsComplited: $IsCompluted})\n    {\n    CheckListUnitID\n    IsComplited\n    Point\n    }\n}\n"]))),Qt=n(360),Wt=n.n(Qt),Kt=n(755),zt=function(e){var t=e.data,n=e.OrderID,a=Object(k.useMutation)(Yt,{update:function(e,t){var a=t.data,r=e.readQuery({query:Re,variables:{OrderID:n}}),c=JSON.parse(JSON.stringify(r));c.erp_Orders[0].CheckListUnits.push(a.insert_erp_CheckListUnits_one),e.writeQuery({query:Re,variables:{OrderID:n},data:c})}}),r=Object(p.a)(a,1)[0],c=Object(k.useMutation)(Rt),i=Object(p.a)(c,1)[0];var s=t.map((function(e){return Object(O.jsx)(Kt.a.div,{initial:{opacity:.3},animate:{opacity:1},transition:{duration:.4},className:e.IsComplited?"CheckListUnit complited":"CheckListUnit",onClick:function(t){return function(e,t){e.target.classList.toggle("complited"),i({variables:{CheckListUnitID:t.CheckListUnitID,IsCompluted:!t.IsComplited}})}(t,e)},children:e.Point},e.CheckListUnitID)}));return Object(O.jsxs)("div",{className:"CheckList noprint",children:[Object(O.jsx)("input",{className:Wt.a.unitInput,type:"text",placeholder:"\u041e\u043f\u0438\u0448\u0438\u0442\u0435 \u0437\u0430\u0434\u0430\u0447\u0443 \u0438 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 enter",onKeyUp:function(e){return function(e){if(13!==e.keyCode||!e.target.value)return null;r({variables:{OrderID:n,Point:e.target.value},optimisticResponse:{insert_erp_CheckListUnits_one:{__typename:"erp_CheckListUnits",CheckListUnitID:"temp-id",Point:e.target.value,IsComplited:!1,OrderID:n}}}),e.target.value=""}(e)}}),s]})},Vt=(n(614),function(e){var t=e.data,n=e.onUpload,a=e.editState,r=e.refetch,c=Object(o.useContext)(pa).store,u=Object(o.useState)(!1),l=Object(p.a)(u,2),d=l[0],b=l[1],j=Object(o.useState)(),m=Object(p.a)(j,2),h=m[0],f=m[1],v=Object(k.useMutation)(We),x=Object(p.a)(v,1)[0],g=function(){return b(!1)};Object(o.useEffect)((function(){b(!1)}),[a]);var I=function(){var e=Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(),e.next=3,c.deleteFile(h.Key,x);case 3:r();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=t.map((function(e){return a?Object(O.jsx)("div",{children:Object(O.jsxs)("div",{onClick:function(){return function(e){f(e),b(!0)}(e)},className:"file-name delete-file",children:[" ",e.FileName," "]})},e.Key):Object(O.jsxs)("a",{href:"".concat("https://factory.piek.ru/api","/s3/get/").concat(e.Key),target:"_blank",rel:"noreferrer",className:"file-name",children:[" ",e.FileName," "]},e.Key)}));return Object(O.jsxs)("div",{className:"Docs",children:[Object(O.jsxs)("div",{className:"filesContainer",children:[D,function(){if(0===n.length)return null;var e=n.map((function(e){return Object(O.jsx)("div",{children:e.path},e.path)}));return Object(O.jsx)("div",{className:"onUploadIcon",children:e})}()]}),Object(O.jsx)("div",{children:Object(O.jsxs)(vt.a,{title:null===h||void 0===h?void 0:h.FileName,isShown:d,confirmLabel:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043d\u0430\u0432\u0441\u0435\u0433\u0434\u0430",onConfirm:I,cancelLabel:"\u041d\u0435 \u043d\u0443\u0436\u043d\u043e",intent:"danger",onCloseComplete:g,children:["\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u043e\u0442 \u0444\u0430\u0439\u043b? ",Object(O.jsx)("br",{}),"\u042d\u0442\u043e \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043d\u0435\u043e\u0431\u0440\u0430\u0442\u0438\u043c\u043e."]})})]})}),Jt=Object(S.b)(Ut||(Ut=Object(M.a)(["\nmutation($OrderID: Int!, $Text: String!, $UserID: Int!) {\n  insert_erp_Comments_one(\n    object: {OrderID: $OrderID, Text: $Text, UserID: $UserID}) \n    {\n    CommentID\n    OrderID\n    Text\n    Timestamp\n    UserID\n  }\n}\n"]))),Gt=Object(S.b)(Ht||(Ht=Object(M.a)(["\n mutation($CommentID: Int!) {\n  delete_erp_Comments_by_pk(CommentID: $CommentID) {\n    CommentID\n  }\n}\n"]))),Zt=Object(S.b)(Et||(Et=Object(M.a)(["\nmutation($CommentID: Int!, $Text: String!, $Timestamp: timestamptz!) {\n  update_erp_Comments_by_pk(\n    pk_columns: {CommentID: $CommentID},\n    _set: {Text: $Text, Timestamp: $Timestamp}) \n    {\n    OrderID\n    Text\n    Timestamp\n    UserID\n    CommentID\n  }\n  }\n"]))),Xt=Object(S.a)(qt||(qt=Object(M.a)(["\n  subscription MySubscritp($OrderID: Int!) {\n    erp_Comments(where: {OrderID: {_eq: $OrderID}}, order_by: {CommentID: desc}) {\n      CommentID\n      Text\n      Timestamp\n      User {\n        UserID\n        FirstName\n        LastName\n      }\n    }\n  }\n"]))),en=n(77),tn=n.n(en),nn=n(756),an=function(e){var t=e.data,n=e.userID,a=e.updateComment,r=e.deleteComment,c=e.nowEditing,o=e.setNowEditing;return Object(O.jsxs)("div",{className:tn.a.commentUnit,children:[Object(O.jsxs)("div",{className:tn.a.commentHeader,children:[Object(O.jsxs)("div",{className:tn.a.sender,children:[" ",n===t.User.UserID?"\u0412\u044b":"".concat(t.User.FirstName," ").concat(t.User.LastName)," "]}),Object(O.jsx)("div",{className:tn.a.actions,children:function(){if(n===t.User.UserID&&(null===c||void 0===c?void 0:c.CommentID)!==t.CommentID)return Object(O.jsx)("div",{onClick:function(){return r(t.CommentID)},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})}()}),Object(O.jsxs)("div",{className:tn.a.time,children:[" ",function(){var e=B()(t.Timestamp);return e.format("MMM D")+" at "+e.format("hh:mm")}()," "]})]}),n===t.User.UserID?Object(O.jsx)("div",{contentEditable:"true",className:tn.a.commentContent,suppressContentEditableWarning:"true",onBlur:function(){var e=Object(s.a)(i.a.mark((function e(n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a(t.CommentID,n.target.innerHTML);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onMouseLeave:function(){var e=Object(s.a)(i.a.mark((function e(n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a(t.CommentID,n.target.innerHTML);case 2:o(null);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),dangerouslySetInnerHTML:{__html:t.Text}},t.CommentID):Object(O.jsx)("div",{className:tn.a.commentContent,children:t.Text})]})},rn=function(e){var t=e.orderID,n=e.user,a=Object(k.useMutation)(Jt),r=Object(p.a)(a,1)[0],c=Object(k.useMutation)(Zt),i=Object(p.a)(c,1)[0],s=Object(k.useMutation)(Gt),u=Object(p.a)(s,1)[0],l=Object(o.useState)(""),d=Object(p.a)(l,2),b=d[0],j=d[1],m=Object(o.useState)(),h=Object(p.a)(m,2),f=h[0],v=h[1],x=Object(k.useSubscription)(Xt,{variables:{OrderID:t}}),g=x.data,I=void 0===g?[]:g,D=x.loading;function y(e,t){i({variables:{CommentID:e,Text:t,Timestamp:new Date}})}function _(e){u({variables:{CommentID:e}})}return Object(O.jsxs)("div",{className:tn.a.commentsListWrapper,children:[Object(O.jsxs)("div",{className:tn.a.commentInputForm,children:[Object(O.jsx)(nn.a,{variant:"standard",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",className:tn.a.commentInput,multiline:!0,fullWidth:!0,size:"small",autoComplete:"off",InputProps:{disableUnderline:!0},value:b,onChange:function(e){return j(e.target.value)}}),b&&Object(O.jsx)("div",{onClick:function(){if(!b)return null;r({variables:{OrderID:t,UserID:n.UserID,Text:b}}),j("")},className:tn.a.saveButton,children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})]}),!D&&I.erp_Comments.map((function(e){return Object(O.jsx)(an,{data:e,userID:n.UserID,deleteComment:_,updateComment:y,nowEditing:f,setNowEditing:v},e.CommentID)}))]})},cn=n(746),sn=function(e){var t,n=document.getElementById("dropzone");if(e)return n.classList.add("isDragAccept"),Object(O.jsx)("div",{children:Object(O.jsx)(cn.a,{className:"inCloudconIcon"})});null===n||void 0===n||null===(t=n.classList)||void 0===t||t.remove("isDragAccept")},on=n(738);n(617);function un(e){return 1===e.OrderStatusID?" | \u041f\u0440\u0435\u0434\u0437\u0430\u043a\u0430\u0437":3===e.OrderStatusID?" | \u0412 \u0430\u0440\u0445\u0438\u0432\u0435":void 0}var ln,dn=function(e){var t=Object(o.useContext)(pa).store,n=Object(o.useState)([]),r=Object(p.a)(n,2),c=r[0],i=r[1],s=new URLSearchParams(Object(m.h)().search).get("edit"),u=Object(o.useState)(s),l=Object(p.a)(u,2),d=l[0],b=l[1],j=Object(k.useMutation)(Qe),h=Object(p.a)(j,1)[0],f=Object(m.i)().id,v=Object(o.useCallback)((function(e){i(e),t.uploadFile(e).then((function(e){if(200!==e.status)console.log("S3 file upload error");else{for(var t=[],n=0;n<e.data.length;n+=2)t.push({Key:e.data[n].key,OrderID:f,FileName:e.data[n].originalname});h({variables:{objects:t}})}i([]),D()}))}),[]),x=Object(k.useQuery)(Re,{variables:{OrderID:f}}),g=x.data,I=void 0===g?[]:g,D=x.refetch,y=Object(k.useQuery)(L).data,_=void 0===y?[]:y,C=Object(Ye.a)({className:"dropzone",onDrop:v}),N=C.getRootProps,w=C.isDragActive;return Object(O.jsxs)("div",{children:[sn(w),I.erp_Orders?Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("section",Object(a.a)(Object(a.a)({className:"OrderLayout"},N()),{},{id:"dropzone",children:[Object(O.jsxs)("div",{className:"LeftSideContent",children:[Object(O.jsxs)("div",{className:"page-header",children:[Object(O.jsxs)(on.a,{children:[I.erp_Orders[0].Entity," __ ",I.erp_Orders[0].City,Object(O.jsx)("span",{className:"preorderTitle",children:un(I.erp_Orders[0])})]}),Object(O.jsx)(xe,{accessLevel:2,setEditState:b,editState:d})]}),Object(O.jsx)("div",{className:"Composition",children:Object(O.jsx)(mt,{data:I.erp_Orders[0].OrderItems,editState:d,refetch:D,orderID:f})}),Object(O.jsx)(rn,{orderID:f,user:t.user,data:I.erp_Orders[0].Comments}),Object(O.jsx)(Vt,{data:I.erp_Orders[0].Docs,onUpload:c,editState:d,refetch:D}),Object(O.jsx)(zt,{data:I.erp_Orders[0].CheckListUnits,OrderID:f})]}),Object(O.jsx)("div",{className:"Info",children:d?Object(O.jsx)(Bt,{data:I.erp_Orders[0],orderID:f,refetch:D,users:_.erp_Users}):Object(O.jsx)(Nt,{data:I.erp_Orders[0],editState:d,orderID:f})})]}))}):null]})},bn=Object(S.a)(ln||(ln=Object(M.a)(["\nquery MyQuery($gte: timestamp!, $lte: timestamp!) {\n  attendance_users_aggregate(\n    order_by: {lastname: asc}\n    ){\n    nodes {\n      id\n      card\n      firstname\n      lastname\n      intervalsPools(where: {entrance: {_gte: $gte,  _lte: $lte}}) {\n        entrance\n        exit\n        card\n        interval\n        status\n      }\n    }\n  }\n}  \n"])));function jn(e){var t=Object(p.a)(e,2),n=t[0],a=t[1];return new Date(a,n+1,0).getDate()}var mn=n(119),pn=n.n(mn);function On(e,t,n){function a(e){var t=e.getMinutes();return t<10?"0".concat(t):t}var r=t.find((function(t){return new Date(t.entrance).getDate()==e}));if(r){var c=new Date(r.entrance),i=new Date(r.exit);return[c.getHours()+":"+a(c),i.getHours()+":"+a(i),function(e,t){e-=t/60;var n=Math.floor(e),a=e-n,r=1/60;a=r*Math.round(a/r);var c=Math.floor(60*a)+"";return c.length<2&&(c="0"+c),n+":"+c}(r.interval,n),r.status]}return[null,null,null,null]}function hn(e){var t=e.columns,n=e.data,r=e.className,c=Object(R.useTable)({columns:t,data:n}),i=c.getTableProps,s=c.getTableBodyProps,o=c.headerGroups,u=c.rows,l=c.prepareRow;return Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("table",Object(a.a)(Object(a.a)({className:r},i()),{},{children:[Object(O.jsx)("thead",{children:o.map((function(e,t){return Object(O.jsx)("tr",Object(a.a)(Object(a.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e,t){return Object(O.jsx)("th",Object(a.a)(Object(a.a)({},e.getHeaderProps()),{},{children:e.render("Header")}))}))}),t)}))}),Object(O.jsx)("tbody",Object(a.a)(Object(a.a)({},s()),{},{children:u.map((function(e,t){return l(e),Object(O.jsx)("tr",Object(a.a)(Object(a.a)({},e.getRowProps()),{},{children:e.cells.map((function(e,t){return Object(O.jsx)("td",Object(a.a)(Object(a.a)({},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}))]}))})}n(618);function fn(e,t){var n=e;return(n=new Date(e.getFullYear(),e.getMonth(),1)).setMonth(n.getMonth()+(t+1)),n.setDate(n.getDate()-1),e.getDate()<n.getDate()&&n.setDate(e.getDate()),n}var vn=function(e){var t=e.state,n=e.dispatch,a=new Date,r=["\u044f\u043d\u0432","\u0444\u0435\u0432","\u043c\u0430\u0440","\u0430\u043f\u0440","\u043c\u0430\u0439","\u0438\u044e\u043d","\u0438\u044e\u043b","\u0430\u0432\u0433","\u0441\u0435\u043d","\u043e\u043a\u0442","\u043d\u043e\u044f","\u0434\u0435\u043a"],c=function(e){var t=new Date(e.target.attributes.date.value);n({type:"selectedMonth",payload:[t.getMonth(),t.getFullYear()]})};return Object(O.jsxs)("div",{className:"reportConfigurator",children:[function(){for(var e=[],n=0;n<6;n++){var i=fn(a,-n);e.push(Object(O.jsxs)("div",{onClick:c,className:i.getMonth()==t.selectedMonth[0]?"active":"",date:i,children:[" ",r[i.getMonth()]," "]}))}return Object(O.jsx)("div",{className:"chooseMonth",children:e})}(),Object(O.jsx)("div",{className:"arguments",children:Object(O.jsxs)("div",{className:"wrap",children:[Object(O.jsx)("span",{children:"\u043e\u0431\u0435\u0434"}),Object(O.jsx)("input",{type:"text",defaultValue:t.timeDeduction,onChange:function(e){n({type:"timeDeduction",payload:parseInt(e.target.value.trim())})}}),Object(O.jsx)("span",{children:"\u043c\u0438\u043d"})]})})]})},xn=function(e){return Object(O.jsxs)("div",{className:"page-header",children:[Object(O.jsx)("span",{children:e.pageParams.icon}),Object(O.jsx)(on.a,{children:e.pageParams.title}),e.children]})},gn=null,In=function(e){var t=new Date,n=Object(o.useContext)(pa).store;var r=Object(o.useReducer)((function(e,t){switch(t.type){case"selectedMonth":case"timeDeduction":case"filtredData":return Object(a.a)(Object(a.a)({},e),{},Object(y.a)({},t.type,t.payload));default:throw new Error}}),{timeDeduction:30,selectedMonth:[t.getMonth()-1,t.getFullYear()]}),c=Object(p.a)(r,2),i=c[0],s=c[1],u=i.timeDeduction,l=i.selectedMonth,d=i.filtredData,b=function(e){var t=Object(p.a)(e,2),n=t[0],a=t[1],r=(parseInt(n)+1).toString().replace(/(^|\D)(\d)(?!\d)/g,"$10$2");return{gte:a+"-"+r+"-01T00:00:00",lte:a+"-"+r+"-"+jn(e)+"T23:59:59"}}(l),j=b.gte,m=b.lte;Object(k.useQuery)(bn,{variables:{gte:j,lte:m},onCompleted:function(e){gn=e.attendance_users_aggregate.nodes,s({type:"filtredData",payload:gn})}}).loading;Object(o.useEffect)((function(){return function(){gn=null}}),[]);var h=function(e){var t=e.target.value.trim();if(""!==t){var n=gn.filter((function(e){return function(e,t){return!!e.lastname.toLowerCase().startsWith(t.toLowerCase())||!!e.firstname.toLowerCase().startsWith(t.toLowerCase())}(e,t)}));s({type:"filtredData",payload:n})}else s({type:"filtredData",payload:gn})},f=Object(o.useMemo)((function(){return function(e,t){for(var n=[{Header:"\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a",accessor:function(e){return Object(O.jsxs)("div",{children:[Object(O.jsxs)("span",{children:[e.lastname," "]}),Object(O.jsxs)("span",{children:[e.firstname," "]})]})}},{Header:"\u0418\u0442\u043e\u0433\u043e",Cell:function(e){var n=0,a=e.row.original.intervalsPools;return a.forEach((function(e){n+=e.interval})),n-=t/60*a.length,Object(O.jsx)("div",{children:n.toFixed(0)})}}],a=1;a<=jn(e);a++)n.push({Header:a.toString(),Cell:function(e){var n=On(e.column.Header,e.row.original.intervalsPools,t),a=Object(p.a)(n,4),r=a[0],c=a[1],i=a[2],s=a[3];return Object(O.jsxs)("div",{className:"status-"+s,children:[Object(O.jsx)("div",{children:r}),Object(O.jsx)("div",{children:c}),Object(O.jsx)("div",{className:pn.a.interval,children:i})]})}});return n}(l,u)}),[l,u]);return Object(O.jsxs)("div",{className:pn.a.attendanceLayout,children:[Object(O.jsx)(xn,{pageParams:n.getPageParams(window.location.pathname),search:h}),Object(O.jsx)(vn,{state:i,dispatch:s}),Object(O.jsxs)("div",{className:pn.a.tableWrapper,children:[Object(O.jsxs)("div",{className:pn.a.tableSearchInput,children:[Object(O.jsx)(W.a,{}),Object(O.jsx)("input",{type:"text",placeholder:"\u043f\u043e\u0438\u0441\u043a (\u043d\u043e\u043c\u0435\u0440 \u0441\u0447\u0435\u0442\u0430 \u0438\u043b\u0438 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f)",onChange:function(e){return h(e)},autoFocus:!0})]}),d&&f&&Object(O.jsx)(hn,{columns:f,data:d,className:pn.a.attendanceTable}),Object(O.jsxs)("div",{className:"".concat(pn.a.tableFooter," legend"),children:[Object(O.jsx)("div",{className:"status-101",children:"\u041f\u0440\u0435\u0440\u0432\u0430\u043d\u043d\u044b\u0439 \u0440\u0430\u0431\u043e\u0447\u0438\u0439 \u0434\u0435\u043d\u044c"}),Object(O.jsx)("div",{className:"status-102",children:"\u041d\u0435 \u043e\u0442\u043c\u0435\u0447\u0435\u043d \u043a\u043e\u043d\u0435\u0446 \u0441\u043c\u0435\u043d\u044b"}),Object(O.jsxs)("span",{className:"reportMeta",children:["\u041e\u0442\u0447\u0435\u0442 \u0437\u0430 ",l[0]+1," \u043c\u0435\u0441\u044f\u0446 ",l[1]," \u0433\u043e\u0434\u0430"]})]})]})]})},Dn=(n(619),function(e){return Object(O.jsx)("div",{})}),yn=function(){return Object(O.jsxs)(m.d,{children:[Object(O.jsx)(m.b,{path:"/login",component:D}),Object(O.jsx)(f,{exact:!0,path:"/",component:Be}),Object(O.jsx)(f,{path:"/attendance",component:In}),Object(O.jsx)(f,{path:"/reclamation",component:Dn}),Object(O.jsx)(f,{path:"/orders/:id",component:dn}),"#if required route was not found",Object(O.jsx)(m.a,{to:"/"})]})},_n=function(e){return Object(O.jsxs)("div",{className:"base-container",children:[Object(O.jsx)(yn,{}),e.children]})},Cn=(n(620),n(751)),Nn=n(752),wn=n(753),kn=n(768),Mn=n(769),Sn=n(771),Tn=n(763),Ln=n(14),Fn=n(747),$n=n(748),An=n(749),Pn=n(750),Un=n(770),Hn=n(776),En=n(202),qn=n.n(En),Bn=n(362),Yn="dark";var Rn=function(){var e=Object(Bn.useMediaQuery)({query:"(prefers-color-scheme: dark)"},void 0),t=Object(o.useState)((function(){return function(e){var t="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===t.length)return t.pop().split(";").shift()}("theme")})),n=Object(p.a)(t,2),a=n[0],r=n[1];return Object(o.useEffect)((function(){"dark"===a?document.documentElement.classList.add(Yn):"light"===a?document.documentElement.classList.remove(Yn):"system"===a&&(e?document.documentElement.classList.add(Yn):document.documentElement.classList.remove(Yn))}),[a,e]),[a,function(e){var t=new Date;t.setFullYear(t.getFullYear()+1),document.cookie="theme=".concat(e,"; expires=").concat(t,"; path=/"),r(e)}]},Qn=Object(Ln.a)(Un.a)((function(e){e.theme;return{"& .MuiToggleButtonGroup-grouped":{border:"1px solid var(--border)",padding:8,textTransform:"none","&:not(:first-of-type)":{},"&:first-of-type":{borderTopLeftRadius:"var(--br)",borderBottomLeftRadius:"var(--br)"},"&:last-of-type":{borderTopRightRadius:"var(--br)",borderBottomRightRadius:"var(--br)"}}}}));function Wn(e){var t="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===t.length)return t.pop().split(";").shift()}function Kn(){var e=Object(o.useContext)(pa).store,t=Object(o.useState)(!1),n=Object(p.a)(t,2),a=n[0],r=n[1],c=Object(m.g)(),u=Rn(),l=Object(p.a)(u,2),d=(l[0],l[1]);function b(){return j.apply(this,arguments)}function j(){return(j=Object(s.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.logout();case 2:c.push("/login");case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var h,f=function(e,t){d(t)},v=function(e){return function(t){r(e)}};return Object(O.jsxs)("div",{children:[Object(O.jsx)("div",{onClick:v(!0),children:Object(O.jsx)(Pn.a,{})}),Object(O.jsx)(Mn.a,{open:a,onClose:v(!1),children:(h="left",Object(O.jsxs)(kn.a,{sx:{width:"top"===h||"bottom"===h?"auto":400},role:"presentation",onKeyDown:v(!1),children:[Object(O.jsxs)(Sn.a,{children:[Object(O.jsx)(Tn.a,{className:qn.a.user,children:Object(O.jsxs)("div",{children:["\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c, ",e.user.FirstName," ",e.user.LastName,"!"]})}),Object(O.jsx)(Tn.a,{children:Object(O.jsxs)(Qn,{className:qn.a.themeToggleButtons,color:"primary",value:Wn("theme"),exclusive:!0,fullWidth:!0,onChange:f,children:[Object(O.jsxs)(Hn.a,{value:"light",children:[" ",Object(O.jsx)(Fn.a,{})," Light"]}),Object(O.jsxs)(Hn.a,{value:"system",children:[" ",Object(O.jsx)($n.a,{}),"System"]}),Object(O.jsxs)(Hn.a,{value:"dark",children:[" ",Object(O.jsx)(An.a,{})," Dark"]})]})})]}),Object(O.jsx)("div",{className:qn.a.logoutButton,children:Object(O.jsx)("button",{onClick:b,children:"\u0412\u044b\u0439\u0442\u0438"})})]}))})]})}var zn=function(){Object(o.useContext)(pa).store;return Object(O.jsxs)("div",{className:"Sidebar noprint",children:[Object(O.jsx)(E.c,{exact:!0,to:"/",activeClassName:"sidebar-active",className:"action-icon",children:Object(O.jsx)(Cn.a,{})}),Object(O.jsx)(E.c,{to:"/reclamation",activeClassName:"sidebar-active",className:"action-icon",children:Object(O.jsx)(Nn.a,{})}),Object(O.jsx)(E.c,{to:"/attendance",activeClassName:"sidebar-active",className:"action-icon",children:Object(O.jsx)(wn.a,{})}),Object(O.jsx)("div",{className:"action-icon settings",children:Object(O.jsx)(Kn,{})})]})},Vn=n(366),Jn=n(754),Gn=Object(Vn.a)({});Gn.overrides={MuiInputLabel:{root:{color:"var(--lowContrast)",fontSize:".8rem"}},MuiOutlinedInput:{notchedOutline:{borderColor:"var(--border)"},focused:{borderColor:"var(--border) !important"}},MuiInputBase:{root:{borderBottom:"none",color:"var(--highContrast)","&::before":{borderColor:"var(--border) !important"}}},MuiIconButton:{root:{color:"var(--lowContrast)",opacity:.5}},MuiAutocomplete:{paper:{background:"var(--L0) !important",border:"1px solid var(--border)"},listbox:{color:"var(--highContrast)",fontSize:".8rem"}}};var Zn=Object(j.a)((function(){var e=Object(o.useContext)(pa).store;return Object(O.jsx)(Jn.a,{theme:Gn,children:Object(O.jsxs)("div",{className:"App",children:[e.inMemoryToken&&Object(O.jsx)(zn,{}),Object(O.jsx)(_n,{})]})})})),Xn=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,779)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))},ea=n(93),ta=n(68),na=n(51),aa=n(239),ra=n(736),ca=n(131),ia=n.n(ca),sa="https://factory.piek.ru/api",oa=ia.a.create({withCredentials:!0,baseURL:sa}),ua=function(){function e(){Object(ea.a)(this,e)}return Object(ta.a)(e,null,[{key:"login",value:function(){var e=Object(s.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",oa.post("/login",{email:t,password:n}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",oa.post("/logout"));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),la=function(){function e(){Object(ea.a)(this,e),this.user={},this.isLoading=!1,this.inMemoryToken=void 0,this.priorityTab=1,this.cachedOrders=[],this.cachedPreOrders=[],this.pageParams=[{url:"/reclamation",icon:Object(O.jsx)(Nn.a,{}),title:"\u0420\u0435\u043a\u043b\u0430\u043c\u0430\u0446\u0438\u044f"},{url:"/attendance",icon:Object(O.jsx)(wn.a,{}),title:"\u0420\u0430\u0431\u043e\u0447\u0435\u0435 \u0432\u0440\u0435\u043c\u044f"}],this.preloader=Object(O.jsx)(aa.a,{display:"flex",alignItems:"center",justifyContent:"center",height:"75vh",children:Object(O.jsx)(ra.a,{})}),Object(na.d)(this)}return Object(ta.a)(e,[{key:"setAuth",value:function(e){this.isAuth=e}},{key:"setUser",value:function(e){this.user=e}},{key:"setLoading",value:function(e){this.isLoading=e}},{key:"setInMemoryToken",value:function(e){this.inMemoryToken=e}},{key:"setPriorutyTab",value:function(e){this.priorityTab=e}},{key:"setCachedOrders",value:function(e){this.cachedOrders=e}},{key:"setCachedPreOrders",value:function(e){this.cachedPreOrders=e}},{key:"login",value:function(){var e=Object(s.a)(i.a.mark((function e(t,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ua.login(t,n);case 3:if(200!==(a=e.sent).status){e.next=8;break}return this.setInMemoryToken(a.data.accessToken),this.setUser(a.data.user),e.abrupt("return",a);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(s.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ua.logout();case 3:this.setInMemoryToken(null),this.setUser({}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(null===(t=e.t0.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"getNewToken",value:function(){var e=Object(s.a)(i.a.mark((function e(){var t=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ia.a.get("".concat(sa,"/refresh"),{withCredentials:!0}).then((function(e){return t.setInMemoryToken(e.data.accessToken),e.data.accessToken})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"checkAuth",value:function(){var e=Object(s.a)(i.a.mark((function e(){var t=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setLoading(!0),e.prev=1,e.next=4,ia.a.get("".concat(sa,"/refresh"),{withCredentials:!0}).then((function(e){200===e.status&&(console.log(e),t.setUser(e.data.user),t.setInMemoryToken(e.data.accessToken),console.log("token validation complited"))}));case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),console.log(e.t0);case 9:return e.prev=9,this.setLoading(!1),e.abrupt("return",this.inMemoryToken);case 13:case"end":return e.stop()}}),e,this,[[1,6,9,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"uploadFile",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new FormData,t.map((function(e){return n.append("files",e)})),e.next=4,ia.a.post("".concat("https://factory.piek.ru/api","/s3/upload"),n,{headers:{"Content-Type":"multipart/form-data"}});case 4:return a=e.sent,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"downloadFile",value:function(){var e=Object(s.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat("https://factory.piek.ru/api","/s3/get/").concat(t.Key));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteFile",value:function(){var e=Object(s.a)(i.a.mark((function e(t,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ia.a.get("".concat("https://factory.piek.ru/api","/s3/delete/").concat(t));case 2:if(200!==e.sent.status){e.next=8;break}return e.next=6,n({variables:{key:t}});case 6:a=e.sent,console.log(a.data);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getPageParams",value:function(e){return this.pageParams.find((function(t){return t.url===e}))}}]),e}(),da=(n(638),n(639),n(640),n(370)),ba=n(363),ja=["headers"],ma=new la,pa=Object(o.createContext)({store:ma}),Oa=new da.a({uri:"wss://hasura.piek.ru/v1/graphql",options:{reconnect:!0,lazy:!0,reconnectionAttempts:5,inactivityTimeout:1e7,connectionCallback:function(){var e=Object(s.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&console.log(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),connectionParams:function(){return{headers:{Authorization:"Bearer ".concat(ma.inMemoryToken)}}}}}),ha=Object(ba.a)(function(){var e=Object(s.a)(i.a.mark((function e(t,n){var c,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=n.headers,s=Object(r.a)(n,ja),o=null,!(Date.now()>=1e3*b.a.decode(ma.inMemoryToken).exp)){e.next=7;break}return console.log("Existed access token was expired, request for new token.."),e.next=6,ma.getNewToken();case 6:o=e.sent;case 7:return e.abrupt("return",Object(a.a)({headers:Object(a.a)(Object(a.a)({},c),o?{Authorization:"Bearer ".concat(o)}:{})},s));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),fa=new k.ApolloClient({link:Object(k.from)([ha,Oa]),cache:new k.InMemoryCache({typePolicies:{erp_Orders:{keyFields:["OrderID"]},erp_CheckListUnits:{keyFields:["CheckListUnitID"]},erp_Comments:{keyFields:["CommentID"]}}})}),va=document.getElementById("root");l.a.render(Object(O.jsx)(k.ApolloProvider,{client:fa,children:Object(O.jsx)(E.a,{children:Object(O.jsx)(Zn,{sessionData:va.dataset.session,children:Object(O.jsx)(pa.Provider,{value:ma})})})}),va),Xn()},77:function(e,t,n){e.exports={commentsListWrapper:"Comments_commentsListWrapper__25Ylk",commentInputForm:"Comments_commentInputForm__2W6Of",saveButton:"Comments_saveButton__FkrZB",commentUnit:"Comments_commentUnit__1L_o5",actions:"Comments_actions__2pxUd",commentContent:"Comments_commentContent__EsGgq",commentHeader:"Comments_commentHeader__3aEgO",sender:"Comments_sender__3ld3S",time:"Comments_time__2egg6"}},89:function(e,t,n){e.exports={name:"composition_name__1O75u",quantity:"composition_quantity__2YtVw",addOrderItem:"composition_addOrderItem__2AnFf",quantityInput:"composition_quantityInput__2zcBe",pushOrderItemButton:"composition_pushOrderItemButton__2NTfr",Unit:"composition_Unit__2Fqng",index:"composition_index__2aXz6",fullName:"composition_fullName__NObJ0"}}},[[650,1,2]]]);
//# sourceMappingURL=main.1bc45322.chunk.js.map