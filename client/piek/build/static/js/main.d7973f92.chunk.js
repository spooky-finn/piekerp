(this.webpackJsonppiek=this.webpackJsonppiek||[]).push([[0],{139:function(e,t,n){},198:function(e,t,n){},199:function(e,t,n){},210:function(e,t,n){},283:function(e,t,n){},284:function(e,t,n){},285:function(e,t,n){},286:function(e,t,n){},287:function(e,t,n){},288:function(e,t,n){},289:function(e,t,n){},317:function(e,t,n){"use strict";n.r(t),n.d(t,"Context",(function(){return Lt}));var a,r,c=n(18),s=n.n(c),i=n(32),o=n(181),u=n(0),l=n(22),d=n.n(l),j=(n(139),n(198),n(179)),b=n(26),O=n(12),h=n(388),p=n(359),m=(n(199),n(1)),f=function(e){var t=Object(u.useState)(""),n=Object(O.a)(t,2),a=n[0],r=n[1],c=Object(u.useState)(""),s=Object(O.a)(c,2),i=s[0],o=s[1],l=Object(u.useContext)(Lt).store,d=Object(b.g)();return Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"loginCard",children:[Object(m.jsx)(h.a,{className:"loginInput",label:"Email",onChange:function(e){return r(e.target.value)}}),Object(m.jsx)(h.a,{label:"Password",type:"password",className:"loginInput",onChange:function(e){return o(e.target.value)}}),Object(m.jsx)(p.a,{className:"Button",variant:"outlined",width:"300px",onClick:function(e){l.login(a,i).then((function(){return d.push("/")}))},children:"\u0412\u043e\u0439\u0442\u0438"})]})})},x=n(5),v=n(11),g=n(8),y=n(25),D=n(27),I=n(24),C=Object(I.a)(a||(a=Object(D.a)(["\nsubscription GetOrders($search: String) {\n    erp_Orders(where: {OrderStatusID: {_neq: 4} }) {\n      OrderID\n      Entity\n      InvoiceNumber\n      City\n      ShippingDate\n      PaidAmount\n      TotalAmount\n      CreatingDate\n      ManagerID\n      OrderStatus {\n        Name\n        ID\n      }\n      OrderItems {\n        Quantity\n        OrderItemID\n        Name\n        OrderID\n      } \n      User {\n        FirstName\n      }\n\n    }  \n  }\n"]))),N=Object(I.a)(r||(r=Object(D.a)(["\nquery getUsers {\n  erp_Users{\n    FirstName\n    LastName\n    UserID\n  }\n}\n"]))),k=n(119),w=n(35),M=n(61),S=n.n(M),F=function(e,t){return e&&t?" - "+(t/e*100).toFixed(0)+"%":" "},_=[{Header:"",id:"index",accessor:function(e,t){return t+1}},{Header:"\u041d\u0430\u0438\u043c.",id:"orderItems",accessor:function(e){return 0==e.OrderItems.length?Object(m.jsx)(w.b,{to:"/orders/".concat(e.OrderID),children:Object(m.jsx)("div",{children:"\u043f\u0443\u0441\u0442\u043e\u0442\u0430..."})}):Object(m.jsx)(w.b,{to:"/orders/".concat(e.OrderID),children:e.OrderItems.map((function(e){return Object(m.jsx)("div",{children:Object(m.jsx)("span",{children:e.Name})},e.OrderItemID)}))})}},{Header:"\u041a\u043e\u043b-\u0432\u043e",accessor:function(e){return e.OrderItems.map((function(e){return Object(m.jsx)("div",{children:Object(m.jsx)("div",{children:e.Quantity})},e.OrderItemID)}))}},{Header:"\u041e\u0442\u0433\u0440\u0443\u0437\u043a\u0430",accessor:function(e){return Object(m.jsxs)(m.Fragment,{children:[" ",S()(e.ShippingDate).format("DD.MM.YY")," "]})}},{Header:"\u0421\u0447\u0435\u0442- \u043e\u043f\u043b\u0430\u0442\u0430",accessor:function(e){return e.InvoiceNumber+F(e.TotalAmount,e.PaidAmount)}},{Header:"\u041a\u043e\u043c\u043f\u0430\u043d\u0438\u044f",accessor:"Entity"},{Header:"\u0413\u043e\u0440.",accessor:"City"},{Header:"\u041c\u0434\u0436.",accessor:function(e){return Object(m.jsx)("div",{className:"priorityTable-manager",children:e.User.FirstName[0]})}}];function P(e){var t=e.columns,n=e.data,a=e.id,r=Object(k.useTable)({columns:t,data:n}),c=r.getTableProps,s=r.getTableBodyProps,i=r.headerGroups,o=r.rows,u=r.prepareRow;return 0==n.length?null:Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("table",Object(g.a)(Object(g.a)({id:a,className:"priorityTable"},c()),{},{children:[Object(m.jsx)("thead",{children:i.map((function(e,t){return Object(m.jsx)("tr",Object(g.a)(Object(g.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e,t){return Object(m.jsx)("th",Object(g.a)(Object(g.a)({},e.getHeaderProps()),{},{children:e.render("Header")}))}))}),t)}))}),Object(m.jsx)("tbody",Object(g.a)(Object(g.a)({},s()),{},{children:o.map((function(e,t){return u(e),Object(m.jsx)("tr",Object(g.a)(Object(g.a)({},e.getRowProps()),{},{children:e.cells.map((function(e,t){return Object(m.jsx)("td",Object(g.a)(Object(g.a)({},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}))]}))})}var L,T,U=n(53),$=Object(I.b)(L||(L=Object(D.a)(["\n    mutation MyMutation($OrderID: Int!, $OrderStatus: Int!){\n    update_erp_Orders_by_pk(pk_columns: {OrderID: $OrderID}, _set: {OrderStatusID: $OrderStatus}) {\n        OrderID\n    }\n  }\n\n"]))),A=n(389),R=n(393),E=n(363),Y=n(361),q=n(360),H=n(362),K=(n(210),function(e){var t,n=Object(u.useContext)(Lt).store,a=Object(u.useState)(n.showPreOrders),r=Object(O.a)(a,2),c=r[0],s=r[1],i=Object(y.useMutation)($),o=Object(O.a)(i,1)[0],l=e.preOrders,d=Object(U.a)(_);return d.push({Header:" ",accessor:function(e){return Object(m.jsx)("div",{onClick:function(){return function(e){o({variables:{OrderID:e.OrderID,OrderStatus:1}}),l.splice(l.indexOf(e),1)}(e)},className:"square-button",children:Object(m.jsx)(q.a,{})})}}),Object(m.jsx)("div",{className:c?"preorders-container active":"preorders-container",children:Object(m.jsxs)(A.a,{square:!0,expanded:!0===c,onChange:(t=!0,function(e,a){n.setShowPreOrders(a),s(!!a&&t)}),children:[Object(m.jsx)(R.a,{"aria-controls":"panel1d-content",id:"panel1d-header",children:Object(m.jsxs)(Y.a,{className:"group-heading preorders-heading",children:[" \u041f\u0440\u0435\u0434\u0437\u0430\u043a\u0430\u0437\u044b ",Object(m.jsx)("span",{children:Object(m.jsx)(H.a,{})})]})}),Object(m.jsx)(E.a,{children:Object(m.jsx)(P,{id:"measuringWrapper",columns:d,data:e.preOrders})})]})})}),Q=function(e){return Object(m.jsxs)("div",{className:"base-container page-header",children:[Object(m.jsx)("span",{children:e.pageParams.icon}),Object(m.jsx)(Y.a,{children:e.pageParams.title}),e.children]})},V=Object(I.b)(T||(T=Object(D.a)(["\nmutation MyMutation($managerID: Int!, $orderStatusID: Int!, $isReclamation: Boolean!) {\n  insert_erp_Orders(objects: {ManagerID: $managerID, OrderStatusID:  $orderStatusID, IsReclamation: $isReclamation}) {\n    returning {\n      OrderID\n    }\n  }\n}\n"]))),B=n(364),W=function(e){var t=Object(y.useMutation)(V,{variables:{managerID:e.userID,orderStatusID:3,isReclamation:!1}}),n=Object(O.a)(t,1)[0],a=function(){n().then((function(t){e.history.push("/orders/".concat(t.data.insert_erp_Orders.returning[0].OrderID,"?edit=true"))}))},r=function(){e.setEditState(!e.editState)};return Object(m.jsxs)("div",{className:"action-block",children:[function(){if(e.createOrder)return Object(m.jsx)("div",{"data-for":"global","data-tip":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c",onClick:a,className:"action-icon",children:Object(m.jsx)(q.a,{})})}(),function(){if(2==e.accessLevel){return Object(m.jsx)("div",{"data-for":"global","data-tip":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c",className:e.editState?"action-icon active":"action-icon",onClick:r,children:Object(m.jsx)(B.a,{})})}}()]})},z=(n(283),n(175)),G=function(e){var t=e.data,n=[],a=[],r=Object(u.useContext)(Lt).store,c=null;t.erp_Orders&&(t.erp_Orders.sort((function(e,t){return t.ShippingDate<e.ShippingDate?1:-1})),t.erp_Orders.forEach((function(e){3==e.OrderStatus.ID?n.push(e):1==e.OrderStatus.ID&&a.push(e)})),c=function(e){var t=[{name:"\u0421\u0435\u0433\u043e\u0434\u043d\u044f",date:S()().subtract(0,"day").format("YYYY-MM-DD"),objs:[]},{name:"\u0412\u0447\u0435\u0440\u0430",date:S()().subtract(1,"day").format("YYYY-MM-DD"),objs:[]},{name:"",objs:[]}];if(e){var n,a=Object(z.a)(e);try{var r=function(){var e=n.value,a=!1;t.forEach((function(t){e.CreatingDate.split("T")[0]===t.date?(t.objs.push(e),a=!0):""!==t.name||a||t.objs.push(e)}))};for(a.s();!(n=a.n()).done;)r()}catch(c){a.e(c)}finally{a.f()}}return t}(a));var s=Object(u.useMemo)((function(){return _}),[]),i=function(e,t){return 0==e.length?null:Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("div",{className:"group-heading",children:t}),Object(m.jsx)("div",{className:"tableWrap",children:Object(m.jsx)(P,{columns:s,data:e})})]})};return Object(m.jsx)(m.Fragment,{children:c?Object(m.jsxs)(m.Fragment,{children:[i(c[0].objs,"\u0421\u0435\u0433\u043e\u0434\u043d\u044f"),i(c[1].objs,"\u0412\u0447\u0435\u0440\u0430"),i(c[2].objs,"\u041e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0435")]}):r.preloader})},J=n(357),X=n(385),Z=n(394),ee=function(e){if(0!=e)return Object(m.jsxs)("div",{className:"managerFilter-indicator",children:[Object(m.jsx)("div",{className:"circle"}),Object(m.jsx)("p",{children:"\u0412\u044b\u0434\u0430\u0447\u0430 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0430 \u0444\u0438\u043b\u044c\u0442\u0440\u043e\u043c"})]})},te=function(e){var t=e.dispatch,n=e.state,a=e.users,r=n.managerFilter;return a?Object(m.jsxs)("div",{className:"managerFilter-form",children:[Object(m.jsx)("span",{className:"filterPlaceholder",children:"manager"}),Object(m.jsx)(J.a,{children:Object(m.jsxs)(X.a,{name:"managerFilter",value:r,onChange:function(e){return t({type:"managerFilter",payload:e.target.value})},disableUnderline:!0,inputProps:{className:"managerFilter-input"},children:[Object(m.jsx)(Z.a,{value:0,children:"\u0412\u0441\u0435"}),a.map((function(e){return Object(m.jsxs)(Z.a,{value:e.UserID,children:[" ","".concat(e.FirstName," ").concat(e.LastName)," "]},e.UserID)}))]})})]}):null},ne=(n(284),n(366)),ae=n(384),re=n(320),ce=n(386),se=n(365),ie=["children","value","index"],oe=void 0;function ue(e,t){switch(t.type){case"orders":case"preOrders":case"priorityTab":case"searchKeyword":case"managerFilter":case"filtredOrders":return Object(g.a)(Object(g.a)({},e),{},Object(v.a)({},t.type,t.payload))}}function le(e){var t=e.children,n=e.value,a=e.index,r=Object(x.a)(e,ie);return Object(m.jsx)("div",Object(g.a)(Object(g.a)({role:"tabpanel",hidden:n!==a,id:"simple-tabpanel-".concat(a),"aria-labelledby":"simple-tab-".concat(a)},r),{},{children:n===a&&Object(m.jsx)(ae.a,{p:3,children:Object(m.jsx)(re.a,{component:"div",children:t})})}))}function de(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}var je,be,Oe,he,pe=function(){var e=Object(u.useContext)(Lt).store,t=Object(u.useReducer)(ue,{orders:[],preOrders:[],priorityTab:e.priorityTab,searchKeyword:"",managerFilter:0,filtredOrders:[]}),n=Object(O.a)(t,2),a=n[0],r=n[1],c=(a.orders,a.preOrders),s=a.priorityTab,i=Object(b.g)(),o=Object(u.useMemo)((function(){return _}),[]),l=Object(y.useQuery)(N).data,d=void 0===l?[]:l,j=Object(y.useSubscription)(C,{onSubscriptionData:function(e){var t=[],n=[];e.subscriptionData.data.erp_Orders.forEach((function(e){3==e.OrderStatus.ID?n.push(e):1==e.OrderStatus.ID&&t.push(e)})),oe=t,r({type:"preOrders",payload:n}),r({type:"orders",payload:t})},fetchPolicy:"cache-and-network",nextFetchPolicy:"cache-first"}),h=(j.loading,j.error,j.data),p=void 0===h?[]:h;return Object(m.jsxs)("div",{children:[Object(m.jsx)(Q,{pageParams:e.getPageParams(window.location.pathname),children:Object(m.jsx)(W,{createOrder:1,userID:e.user.UserID,history:i})}),Object(m.jsx)(K,{preOrders:c}),Object(m.jsx)("div",{className:"priorityTabs",children:Object(m.jsxs)(ce.a,{value:s,onChange:function(t,n){r({type:"priorityTab",payload:n}),e.setPriorutyTab(n)},"aria-label":"simple tabs example",indicatorColor:"primary",children:[Object(m.jsx)(se.a,Object(g.a)({label:"\u041e\u0447\u0435\u0440\u0435\u0434\u043d\u043e\u0441\u0442\u044c"},de(0))),Object(m.jsx)(se.a,Object(g.a)({label:"\u041d\u0435\u0434\u0430\u0432\u043d\u0438\u0435"},de(1)))]})}),Object(m.jsx)(le,{value:s,index:0,children:Object(m.jsxs)("div",{className:"tableWrap",children:[Object(m.jsxs)("div",{className:"tableSearchInput",children:[Object(m.jsx)(ne.a,{className:"action-icon"}),Object(m.jsx)("input",{type:"text",placeholder:"\u043f\u043e\u0438\u0441\u043a (\u043d\u043e\u043c\u0435\u0440 \u0441\u0447\u0435\u0442\u0430 \u0438\u043b\u0438 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f)",onChange:function(e){return r({type:"searchKeyword",payload:e.target.value.trim()})},autoFocus:!0}),Object(m.jsx)(te,{dispatch:r,state:a,users:d.erp_Users,incomingOrders:oe})]}),ee(a.managerFilter),oe&&Object(m.jsx)(P,{columns:o,data:function(){var e=a.searchKeyword,t=[];if(t=""!==e?oe.filter((function(t){return function(e){for(var t=!1,n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];return a.map((function(n){n&&n.toLowerCase().includes(e.toLowerCase())&&(t=!0)})),!!t}(e,t.InvoiceNumber,t.Entity)})):oe,0!=a.managerFilter){var n=[];return t.map((function(e){e.ManagerID==a.managerFilter&&n.push(e)})),n}return t}()})]})}),Object(m.jsx)(le,{value:s,index:1,className:"recentlyLayout",children:Object(m.jsx)(G,{data:p})})]})},me=n(180),fe=Object(I.a)(je||(je=Object(D.a)(["\nquery MyQuery($OrderID: Int!) {\n  erp_Orders(where: {OrderID: {_eq: $OrderID}}) {\n    City\n    CreatingDate\n    Comment\n    Entity\n    InvoiceNumber\n    IsReclamation\n    ManagerID\n    OrderID\n    OrderNumber\n    OrderStatusID\n    PaidAmount\n    ShipmentComment\n    ShippingDate\n    TotalAmount\n    User {\n      FirstName\n      LastName\n      UserID\n    }\n    OrderItems {\n      Fitter\n      Name\n      FullName\n      OrderItemID\n      OrderID\n      Quantity\n      SerialNumber\n    }\n    CheckListUnits {\n      IsComplited\n      OrderID\n      Point\n      CheckListUnitID\n    }\n    Docs {\n      Key\n      FileName\n    }\n  }\n}\n"]))),xe=Object(I.b)(be||(be=Object(D.a)(["\nmutation MyMutation($objects: [erp_Docs_insert_input!]!) {\n  insert_erp_Docs(objects: $objects) {\n    returning {\n      ID\n    }\n  }\n}\n"]))),ve=Object(I.b)(Oe||(Oe=Object(D.a)(["\n    mutation MyMutation($key: String!) {\n    delete_erp_Docs(where: {Key: {_eq: $key} }) {\n        returning {\n        Key\n        }\n    }\n    }\n"]))),ge=function(e){return Object(m.jsx)(m.Fragment,{children:e.data.map((function(e){return Object(m.jsxs)("div",{className:"Unit",children:[Object(m.jsxs)("div",{className:"firstRow",children:[Object(m.jsxs)("div",{className:"name",children:[" ",e.Name," "]}),Object(m.jsxs)("span",{className:"quantity",children:[" ",e.Quantity]})]}),Object(m.jsxs)("div",{className:"fullName",children:[" ",e.FullName]})]},e.OrderItemID)}))})},ye=n(367),De=(n(285),function(e){return Object(m.jsxs)("div",{className:"Meta",children:[Object(m.jsxs)("div",{className:"SignificantInfo",children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("pre",{children:"\u041f\u043b\u0430\u043d. \u043e\u0442\u0433\u0440\u0443\u0437\u043a\u0430"}),S()(e.data.ShippingDate).format("DD.MM.YY")]}),Object(m.jsxs)("div",{children:[Object(m.jsx)("pre",{children:"\u0421\u0447\u0435\u0442 / \u043e\u043f\u043b\u0430\u0442\u0430"}),"\u2116 "+e.data.InvoiceNumber+F(e.data.TotalAmount,e.data.PaidAmount),Object(m.jsx)("span",{className:"PaymentHistory",children:Object(m.jsx)(ye.a,{})})]})]}),Object(m.jsxs)("div",{className:"MetaWrapper",children:[Object(m.jsxs)("div",{className:"Left",children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("pre",{children:"\u041d\u043e\u043c\u0435\u0440 \u0437\u0430\u043a\u0430\u0437\u0430"}),e.data.OrderNumber]}),Object(m.jsxs)("div",{children:[Object(m.jsx)("pre",{children:"\u0421\u043e\u0437\u0434\u0430\u043d"}),e.data.ShippingDate]}),Object(m.jsxs)("div",{children:[Object(m.jsx)("pre",{children:"\u041c\u0435\u043d\u0435\u0434\u0436\u0435\u0440"}),e.data.User.FirstName," ",e.data.User.LastName]})]}),Object(m.jsxs)("div",{className:"Right",children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("pre",{children:"\u042e\u0440 \u041b\u0438\u0446\u043e"}),e.data.Entity]}),Object(m.jsxs)("div",{children:[Object(m.jsx)("pre",{children:"\u0413\u043e\u0440"}),e.data.City]})]})]}),Object(m.jsxs)("div",{className:"OrderComment",children:[Object(m.jsx)("pre",{children:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"}),e.data.Comment]})]})}),Ie=(n(286),Object(I.b)(he||(he=Object(D.a)(["\n mutation MyMutation($fields: erp_Orders_set_input, $orderID: Int!) {\n  update_erp_Orders_by_pk(pk_columns: {OrderID: $orderID}, _set: $fields) {\n\t\tOrderID\n  }\n}\n"])))),Ce=n(131),Ne=["inputRef","onChange"],ke=["inputRef","onChange"],we={};function Me(e){var t=e.inputRef,n=e.onChange,a=Object(x.a)(e,Ne);return Object(m.jsx)(Ce.a,Object(g.a)(Object(g.a)({},a),{},{getInputRef:t,onValueChange:function(t){n({target:{name:e.name,value:t.value}})},format:"##.##.##"}))}function Se(e){var t=e.inputRef,n=e.onChange,a=Object(x.a)(e,ke);return Object(m.jsx)(Ce.a,Object(g.a)(Object(g.a)({},a),{},{getInputRef:t,onValueChange:function(t){n({target:{name:e.name,value:t.value}})},prefix:"\u20bd ",thousandSeparator:!0}))}var Fe,_e,Pe,Le=function(e){var t=e.data,n=e.orderID,a=e.refetch,r=function(e){return we[e.target.name]=e.target.value},c=Object(y.useMutation)(Ie),s=Object(O.a)(c,1)[0];return Object(u.useEffect)((function(){return we={},function(){console.log("doing mutation for order",n,we),s({variables:{orderID:n,fields:we}}),a()}}),[]),Object(m.jsxs)("form",{className:"Meta EditableInfo",children:[Object(m.jsx)(h.a,{label:"\u041f\u043b\u0430\u043d. \u043e\u0442\u0433\u0440\u0443\u0437\u043a\u0430",name:"ShippingDate",defaultValue:S()(t.ShippingDate).format("DD.MM.YY"),onChange:function(e){e.target.value=S()(e.target.value,"DD-MM-YY").format("YYYY-MM-DD"),r(e)},placeholder:"dd.mm.yy",autoComplete:"off",InputProps:{inputComponent:Me}}),Object(m.jsx)(h.a,{label:"\u041d\u043e\u043c\u0435\u0440 \u0441\u0447\u0435\u0442\u0430",type:"number",name:"InvoiceNumber",defaultValue:t.InvoiceNumber,onChange:r}),Object(m.jsx)(h.a,{label:"\u041d\u043e\u043c\u0435\u0440 \u0437\u0430\u043a\u0430\u0437\u0430",type:"number",name:"OrderNumber",defaultValue:t.OrderNumber,onChange:r}),Object(m.jsx)(h.a,{label:"\u042e\u0440 \u043b\u0438\u0446\u043e",autoComplete:"off",name:"Entity",defaultValue:t.Entity,onChange:r}),Object(m.jsx)(h.a,{label:"\u0413\u043e\u0440\u043e\u0434",autoComplete:"off",name:"City",defaultValue:t.City,onChange:r}),Object(m.jsx)(h.a,{label:"\u0421\u0443\u043c\u043c\u0430 \u0437\u0430\u043a\u0430\u0437\u0430",name:"TotalAmount",defaultValue:t.TotalAmount,autoComplete:"off",onChange:r,InputProps:{inputComponent:Se}}),Object(m.jsx)(h.a,{label:"\u041e\u043f\u043b\u0430\u0447\u0435\u043d\u043e",name:"PaidAmount",defaultValue:t.PaidAmount,autoComplete:"off",onChange:r,InputProps:{inputComponent:Se}}),Object(m.jsx)(h.a,{label:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",multiline:!0,autoComplete:"off",name:"Comment",defaultValue:t.Comment,onChange:r})]})},Te=Object(I.b)(Fe||(Fe=Object(D.a)(["\nmutation MyMutation($CheckListUnitID: Int!, $IsCompluted: Boolean!) {\n  update_erp_CheckListUnits_by_pk(pk_columns: {CheckListUnitID: $CheckListUnitID}, _set: {IsComplited: $IsCompluted}) {\n    CheckListUnitID\n    IsComplited\n    Point\n  }\n}\n"]))),Ue=function(e){var t=e.data,n=Object(y.useMutation)(Te),a=Object(O.a)(n,2),r=a[0],c=(a[1].loading,JSON.parse(JSON.stringify(t)));c.sort((function(e,t){return t.Point<e.Point?1:-1}));var s=c.map((function(e){return Object(m.jsx)("div",{className:e.IsComplited?"CheckListUnit complited":"CheckListUnit",onClick:function(t){return function(e,t){e.target.classList.toggle("complited"),r({variables:{CheckListUnitID:t.CheckListUnitID,IsCompluted:!t.IsComplited}})}(t,e)},children:e.Point},e.CheckListUnitID)}));return Object(m.jsx)("div",{className:"CheckList",children:s})},$e=n(390),Ae=n(368),Re=n(369),Ee=n(370),Ye=function(e){var t=e.data,n=e.onUpload,a=e.editState,r=e.refetch,c=Object(u.useContext)(Lt).store,o=Object(u.useState)(!1),l=Object(O.a)(o,2),d=l[0],j=l[1],b=Object(u.useState)(),f=Object(O.a)(b,2),x=f[0],v=f[1],g=Object(y.useMutation)(ve),D=Object(O.a)(g,1)[0],I=Object(u.useRef)(),C=function(){return j(!1)},N=function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(C(),"\u0414\u0430"!=I.current.value){e.next=5;break}return e.next=4,c.deleteFile(x.Key,D);case 4:r();case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=t.map((function(e){return a?Object(m.jsx)("div",{children:Object(m.jsxs)("div",{onClick:function(){return function(e){v(e),j(!0)}(e)},className:"file-name delete-file",children:[" ",e.FileName," "]})},e.Key):Object(m.jsxs)("div",{onClick:function(){return c.downloadFile(e)},className:"file-name",children:[" ",e.FileName," "]},e.Key)}));return Object(m.jsxs)("div",{className:"Docs",children:[k,function(){if(0==n.length)return null;var e=n.map((function(e){return Object(m.jsx)("div",{children:e.path},e.path)}));return Object(m.jsx)("div",{className:"onUploadIcon",children:e})}(),Object(m.jsx)("div",{children:Object(m.jsxs)($e.a,{open:d,onClose:C,"aria-labelledby":"form-dialog-title",maxWidth:"xs",children:[Object(m.jsxs)(Ae.a,{children:[Object(m.jsxs)(Re.a,{children:["\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c ",Object(m.jsx)("span",{children:null===x||void 0===x?void 0:x.FileName})," ? ",Object(m.jsx)("br",{}),'\u042d\u0442\u043e \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043d\u0435\u043e\u0431\u0440\u0430\u0442\u0438\u043c\u043e. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 "\u0414\u0430" \u0434\u043b\u044f \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u044f.']}),Object(m.jsx)(h.a,{autoFocus:!0,margin:"dense",fullWidth:!0,autoComplete:"off",inputRef:I})]}),Object(m.jsx)(Ee.a,{children:Object(m.jsx)(p.a,{onClick:N,className:"dialog-danger-btn",children:"\u042f \u043f\u043e\u043d\u0438\u043c\u0430\u044e \u043f\u043e\u0441\u043b\u0435\u0434\u0441\u0442\u0432\u0438\u044f, \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u043e\u0442 \u0444\u0430\u0439\u043b"})})]})})]})},qe=function(e){return Object(m.jsx)("div",{})},He=n(371),Ke=function(e){var t,n=document.getElementById("dropzone");if(e)return n.classList.add("isDragAccept"),Object(m.jsx)(He.a,{className:"inCloudconIcon"});null===n||void 0===n||null===(t=n.classList)||void 0===t||t.remove("isDragAccept")},Qe=(n(287),n(372)),Ve=Object(I.b)(_e||(_e=Object(D.a)(["\n mutation MyMutation($name: String!, $orderID: Int!, $quantity: Int!, $fullName: String!) {\n  insert_erp_OrderItems_one(object: {\n    OrderID: $orderID,\n    Name: $name,\n    FullName: $fullName,\n    Quantity: $quantity,\n    }) {\n    OrderItemID\n    OrderID\n  }\n}\n"]))),Be=function(e){var t=e.editState,n=e.orderID,a=e.refetch,r=Object(y.useMutation)(Ve),c=Object(O.a)(r,2),s=c[0],i=(c[1].loading,Object(u.useRef)(null)),o=Object(u.useRef)(null),l=Object(u.useRef)(null),d=function(){""!=o.current.value&&s({variables:{orderID:n,name:i.current.value,quantity:o.current.value,fullName:l.current.value}}).then((function(){return a()})),i.current.value=null,o.current.value=null,l.current.value=null};return t?Object(m.jsx)("div",{className:"addOrderItem",children:Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(h.a,{size:"small",className:"name",label:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",autoComplete:"off",inputRef:i}),Object(m.jsx)(h.a,{size:"small",className:"quantity",label:"\u041a\u043e\u043b-\u0432\u043e",type:"number",inputRef:o,autoComplete:"off"}),Object(m.jsx)(h.a,{label:"\u041f\u043e\u043b\u043d\u043e\u0435 \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",className:"fullName",multiline:!0,autoComplete:"off",name:"Comment",inputRef:l}),Object(m.jsx)("div",{className:"square-button push-order-item",onClick:d,children:Object(m.jsx)(Qe.a,{})})]})}):null},We=function(e){var t=Object(u.useContext)(Lt).store,n=Object(u.useState)([]),a=Object(O.a)(n,2),r=a[0],c=a[1],s=new URLSearchParams(Object(b.h)().search).get("edit"),i=Object(u.useState)(s),o=Object(O.a)(i,2),l=o[0],d=o[1],j=Object(y.useMutation)(xe),h=Object(O.a)(j,1)[0],p=Object(b.i)().id,f=Object(u.useCallback)((function(e){c(e),t.uploadFile(e).then((function(e){if(200!=e.status)console.log("S3 file upload error");else{for(var t=[],n=0;n<e.data.length;n+=2)t.push({Key:e.data[n].key,OrderID:p,FileName:e.data[n].originalname});h({variables:{objects:t}})}c([]),C()}))}),[]),x=Object(y.useQuery)(fe,{fetchPolicy:"no-cache",variables:{OrderID:p}}),v=x.loading,D=(x.error,x.data),I=void 0===D?[]:D,C=x.refetch,N=Object(me.a)({className:"dropzone",onDrop:f}),k=N.getRootProps,w=N.isDragActive;return console.log(),Object(m.jsxs)(m.Fragment,{children:[Ke(w),v?t.preloader:Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("div",{className:"page-header",children:[Object(m.jsxs)(Y.a,{children:[I.erp_Orders[0].Entity," __  ",I.erp_Orders[0].City]}),Object(m.jsx)(W,{accessLevel:2,setEditState:d,editState:l})]}),Object(m.jsxs)("section",Object(g.a)(Object(g.a)({className:"OrderLayout"},k()),{},{id:"dropzone",children:[Object(m.jsxs)("div",{className:"Main",children:[Object(m.jsxs)("div",{className:"Composition",children:[Object(m.jsx)(ge,{data:I.erp_Orders[0].OrderItems}),Object(m.jsx)(Be,{editState:l,orderID:p,refetch:C})]}),Object(m.jsxs)("div",{className:"WrapperTwoCol",children:[Object(m.jsx)(Ue,{data:I.erp_Orders[0].CheckListUnits}),Object(m.jsx)(Ye,{data:I.erp_Orders[0].Docs,onUpload:r,editState:l,refetch:C})]}),Object(m.jsx)(qe,{})]}),l?Object(m.jsx)(Le,{data:I.erp_Orders[0],orderID:p,refetch:C}):Object(m.jsx)(De,{data:I.erp_Orders[0],editState:l})]}))]})]})},ze=Object(I.a)(Pe||(Pe=Object(D.a)(["\nquery MyQuery($gte: timestamp!, $lte: timestamp!) {\n  attendance_users_aggregate(\n    order_by: {lastname: asc}\n    ){\n    nodes {\n      id\n      card\n      firstname\n      lastname\n      intervalsPools(where: {entrance: {_gte: $gte,  _lte: $lte}}) {\n        entrance\n        exit\n        card\n        interval\n        status\n      }\n    }\n  }\n}  \n"])));function Ge(e){var t=Object(O.a)(e,2),n=t[0],a=t[1];return new Date(a,n+1,0).getDate()}function Je(e,t,n){function a(e){var t=e.getMinutes();return t<10?"0".concat(t):t}var r=t.find((function(t){return new Date(t.entrance).getDate()==e}));if(r){var c=new Date(r.entrance),s=new Date(r.exit);return[c.getHours()+":"+a(c),s.getHours()+":"+a(s),function(e,t){e-=t/60;var n=Math.floor(e),a=e-n,r=1/60;a=r*Math.round(a/r);var c=Math.floor(60*a)+"";return c.length<2&&(c="0"+c),n+":"+c}(r.interval,n),r.status]}return[null,null,null,null]}function Xe(e){var t=e.columns,n=e.data,a=e.className,r=Object(k.useTable)({columns:t,data:n}),c=r.getTableProps,s=r.getTableBodyProps,i=r.headerGroups,o=r.rows,u=r.prepareRow;return Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("table",Object(g.a)(Object(g.a)({className:a},c()),{},{children:[Object(m.jsx)("thead",{children:i.map((function(e,t){return Object(m.jsx)("tr",Object(g.a)(Object(g.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e,t){return Object(m.jsx)("th",Object(g.a)(Object(g.a)({},e.getHeaderProps()),{},{children:e.render("Header")}))}))}),t)}))}),Object(m.jsx)("tbody",Object(g.a)(Object(g.a)({},s()),{},{children:o.map((function(e,t){return u(e),Object(m.jsx)("tr",Object(g.a)(Object(g.a)({},e.getRowProps()),{},{children:e.cells.map((function(e,t){return Object(m.jsx)("td",Object(g.a)(Object(g.a)({},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}))]}))})}n(288);function Ze(e,t){var n=e;return(n=new Date(e.getFullYear(),e.getMonth(),1)).setMonth(n.getMonth()+(t+1)),n.setDate(n.getDate()-1),e.getDate()<n.getDate()&&n.setDate(e.getDate()),n}var et=function(e){var t=e.state,n=e.dispatch,a=new Date,r=["\u044f\u043d\u0432","\u0444\u0435\u0432","\u043c\u0430\u0440","\u0430\u043f\u0440","\u043c\u0430\u0439","\u0438\u044e\u043d","\u0438\u044e\u043b","\u0430\u0432\u0433","\u0441\u0435\u043d","\u043e\u043a\u0442","\u043d\u043e\u044f","\u0434\u0435\u043a"],c=function(e){var t=new Date(e.target.attributes.date.value);n({type:"selectedMonth",payload:[t.getMonth(),t.getFullYear()]})};return Object(m.jsxs)("div",{className:"reportConfigurator",children:[function(){for(var e=[],n=0;n<6;n++){var s=Ze(a,-n);e.push(Object(m.jsxs)("div",{onClick:c,className:s.getMonth()==t.selectedMonth[0]?"active":"",date:s,children:[" ",r[s.getMonth()]," "]}))}return Object(m.jsx)("div",{className:"chooseMonth",children:e})}(),Object(m.jsx)("div",{className:"arguments",children:Object(m.jsxs)("div",{className:"wrap",children:[Object(m.jsx)("span",{children:"\u043e\u0431\u0435\u0434"}),Object(m.jsx)("input",{type:"text",defaultValue:t.timeDeduction,onChange:function(e){n({type:"timeDeduction",payload:parseInt(e.target.value.trim())})}}),Object(m.jsx)("span",{children:"\u043c\u0438\u043d"})]})})]})},tt=null,nt=function(e){var t=new Date,n=Object(u.useContext)(Lt).store;var a=Object(u.useReducer)((function(e,t){switch(t.type){case"selectedMonth":case"timeDeduction":case"filtredData":return Object(g.a)(Object(g.a)({},e),{},Object(v.a)({},t.type,t.payload));default:throw new Error}}),{timeDeduction:30,selectedMonth:[t.getMonth()-1,t.getFullYear()]}),r=Object(O.a)(a,2),c=r[0],s=r[1],i=c.timeDeduction,o=c.selectedMonth,l=c.filtredData,d=function(e){var t=Object(O.a)(e,2),n=t[0],a=t[1],r=(parseInt(n)+1).toString().replace(/(^|\D)(\d)(?!\d)/g,"$10$2");return{gte:a+"-"+r+"-01T00:00:00",lte:a+"-"+r+"-"+Ge(e)+"T23:59:59"}}(o),j=d.gte,b=d.lte;Object(y.useQuery)(ze,{variables:{gte:j,lte:b},onCompleted:function(e){tt=e.attendance_users_aggregate.nodes,s({type:"filtredData",payload:tt})}}).loading;Object(u.useEffect)((function(){return function(){tt=null}}),[]);var h=function(e){var t=e.target.value.trim();if(""!==t){var n=tt.filter((function(e){return function(e,t){return!!e.lastname.toLowerCase().startsWith(t.toLowerCase())||!!e.firstname.toLowerCase().startsWith(t.toLowerCase())}(e,t)}));s({type:"filtredData",payload:n})}else s({type:"filtredData",payload:tt})},p=Object(u.useMemo)((function(){return function(e,t){for(var n=[{Header:"\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a",accessor:function(e){return Object(m.jsxs)("div",{children:[Object(m.jsxs)("span",{children:[e.lastname," "]}),Object(m.jsxs)("span",{children:[e.firstname," "]})]})}},{Header:"\u0418\u0442\u043e\u0433\u043e",Cell:function(e){var n=0,a=e.row.original.intervalsPools;return a.forEach((function(e){n+=e.interval})),n-=t/60*a.length,Object(m.jsx)("div",{children:n.toFixed(0)})}}],a=1;a<=Ge(e);a++)n.push({Header:a.toString(),Cell:function(e){var n=Je(e.column.Header,e.row.original.intervalsPools,t),a=Object(O.a)(n,4),r=a[0],c=a[1],s=a[2],i=a[3];return Object(m.jsxs)("div",{className:"status-"+i,children:[Object(m.jsx)("div",{className:"eventTime",children:r}),Object(m.jsx)("div",{className:"eventTime",children:c}),Object(m.jsx)("div",{className:"interval",children:s})]})}});return n}(o,i)}),[o,i]);return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(Q,{pageParams:n.getPageParams(window.location.pathname),search:h}),Object(m.jsx)(et,{state:c,dispatch:s}),Object(m.jsxs)("div",{className:"tableWrap",children:[Object(m.jsxs)("div",{className:"tableSearchInput",children:[Object(m.jsx)(ne.a,{className:"action-icon"}),Object(m.jsx)("input",{type:"text",placeholder:"\u043f\u043e\u0438\u0441\u043a (\u043d\u043e\u043c\u0435\u0440 \u0441\u0447\u0435\u0442\u0430 \u0438\u043b\u0438 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f)",onChange:function(e){return h(e)},autoFocus:!0})]}),l&&p&&Object(m.jsx)(Xe,{columns:p,data:l,className:"attendance-table"}),Object(m.jsxs)("div",{className:"tableFooter legend",children:[Object(m.jsx)("div",{className:"status-101",children:"\u041f\u0440\u0435\u0440\u0432\u0430\u043d\u043d\u044b\u0439 \u0440\u0430\u0431\u043e\u0447\u0438\u0439 \u0434\u0435\u043d\u044c"}),Object(m.jsx)("div",{className:"status-102",children:"\u041d\u0435 \u043e\u0442\u043c\u0435\u0447\u0435\u043d \u043a\u043e\u043d\u0435\u0446 \u0441\u043c\u0435\u043d\u044b"}),Object(m.jsxs)("span",{className:"reportMeta",children:["\u041e\u0442\u0447\u0435\u0442 \u0437\u0430 ",o[0]+1," \u043c\u0435\u0441\u044f\u0446 ",o[1]," \u0433\u043e\u0434\u0430"]})]})]})]})},at=["component"],rt=function(e){var t=e.component,n=Object(x.a)(e,at),a=Object(u.useState)(void 0),r=Object(O.a)(a,2),c=r[0],o=r[1],l=Object(u.useState)(void 0),d=Object(O.a)(l,2),j=d[0],h=d[1],p=Object(u.useContext)(Lt).store;function f(){return(f=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.checkAuth();case 2:t=e.sent,h(t.isAuth),o(t.isLoaded);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(u.useEffect)((function(){p.inMemoryToken?(h(!0),o(!0)):function(){f.apply(this,arguments)}()}),[]),Object(m.jsx)(b.b,Object(g.a)(Object(g.a)({},n),{},{render:function(e){if(c)return j?Object(m.jsx)(t,Object(g.a)({},e)):Object(m.jsx)(b.a,{to:"/login"})}}))},ct=function(e){return Object(m.jsxs)(b.d,{children:[Object(m.jsx)(b.b,{path:"/login",component:f}),Object(m.jsx)(rt,{exact:!0,path:"/",component:pe}),Object(m.jsx)(rt,{path:"/recently",component:G}),Object(m.jsx)(rt,{path:"/attendance",component:nt}),Object(m.jsx)(rt,{path:"/orders/:id",component:We}),"#if required route was not found",Object(m.jsx)(b.a,{to:"/"})]})},st=function(e){return Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"base-container",children:[Object(m.jsx)(ct,{}),e.children]})})},it=n(375),ot=(n(289),n(376)),ut=n(377),lt=n(378),dt=n(379),jt=n(380),bt=n(177),Ot=n(373),ht=n(374),pt="dark",mt=function(e){var t=Object(bt.useMediaQuery)({query:"(prefers-color-scheme: dark)"},void 0,(function(e){c(e)})),n=Object(u.useState)(t),a=Object(O.a)(n,2),r=a[0],c=a[1];return Object(u.useEffect)((function(){r?document.documentElement.classList.add(pt):document.documentElement.classList.remove(pt)}),[r]),"none"==e.display?null:Object(m.jsx)(m.Fragment,{children:Object(m.jsx)("div",{className:"DarkToggle ",onClick:function(){return c(!r)},children:r?Object(m.jsx)(Ot.a,{}):Object(m.jsx)(ht.a,{})})})},ft=function(){var e=Object(u.useContext)(Lt).store;return Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)(it.a,{className:"Sidebar",children:[Object(m.jsx)(w.c,{exact:!0,to:"/",activeClassName:"sidebar-active",className:"action-icon",children:Object(m.jsx)(ot.a,{})}),Object(m.jsx)(w.c,{to:"/reclamation",activeClassName:"sidebar-active",className:"action-icon",children:Object(m.jsx)(ut.a,{})}),Object(m.jsx)(w.c,{to:"/attendance",activeClassName:"sidebar-active",className:"action-icon",children:Object(m.jsx)(lt.a,{})}),Object(m.jsx)("a",{className:"action-icon hidden",children:Object(m.jsx)(mt,{})}),Object(m.jsx)(w.c,{className:"action-icon hidden",to:"/account",children:Object(m.jsx)(dt.a,{})}),Object(m.jsx)(w.c,{className:"action-icon hidden",to:"/login",onClick:function(){return e.logout()},children:Object(m.jsx)(jt.a,{})})]})})};var xt=Object(j.a)((function(){var e=Object(u.useContext)(Lt).store;return Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"App",children:[e.isAuth?Object(m.jsx)(ft,{}):null,Object(m.jsx)(mt,{display:"none"}),Object(m.jsx)(st,{})]})})})),vt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,396)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),a(e),r(e),c(e),s(e)}))},gt=n(85),yt=n(59),Dt=n(31),It=n(382),Ct=n(78),Nt=n.n(Ct),kt="http://localhost:9000/api",wt=Nt.a.create({withCredentials:!0,baseURL:kt});wt.interceptors.request.use((function(e){return e.headers.Authorization="Bearer ".concat(localStorage.getItem("token")),e})),wt.interceptors.response.use((function(e){return e}),function(){var e=Object(i.a)(s.a.mark((function e(t){var n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.config,401!==t.response.status||!t.config||t.config._isRetry){e.next=14;break}return n._isRetry=!0,e.prev=3,e.next=6,Nt.a.get("".concat(kt,"/refresh"),{withCredentials:!0});case 6:return a=e.sent,localStorage.setItem("token",a.data.accessToken),e.abrupt("return",wt.request(n));case 11:e.prev=11,e.t0=e.catch(3),console.log("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u043e\u0431\u043b\u043e\u043c\u0438\u043b\u0430\u0441\u044c. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0441\u043d\u043e\u0432\u0430");case 14:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}());var Mt=wt,St=function(){function e(){Object(gt.a)(this,e)}return Object(yt.a)(e,null,[{key:"login",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Mt.post("/login",{email:t,password:n}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Mt.post("/logout"));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),Ft=n(381),_t=function(){function e(){Object(gt.a)(this,e),this.user={},this.isAuth=!1,this.isLoading=!1,this.inMemoryToken=void 0,this.priorityTab=0,this.showPreOrders=!1,this.pageParams=[{url:"/",icon:Object(m.jsx)(ot.a,{}),title:"\u041e\u0447\u0435\u0440\u0435\u0434\u043d\u043e\u0441\u0442\u044c \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f"},{url:"/recently",icon:Object(m.jsx)(Ft.a,{}),title:"\u041d\u0435\u0434\u0430\u0432\u043d\u0438\u0435"},{url:"/reclamation",icon:Object(m.jsx)(ut.a,{}),title:"\u0420\u0435\u043a\u043b\u0430\u043c\u0430\u0446\u0438\u044f"},{url:"/attendance",icon:Object(m.jsx)(lt.a,{}),title:"\u0420\u0430\u0431\u043e\u0447\u0435\u0435 \u0432\u0440\u0435\u043c\u044f"}],this.preloader=Object(m.jsx)(it.a,{display:"flex",alignItems:"center",justifyContent:"center",height:"75vh",children:Object(m.jsx)(It.a,{})}),Object(Dt.d)(this)}return Object(yt.a)(e,[{key:"setAuth",value:function(e){this.isAuth=e}},{key:"setUser",value:function(e){this.user=e}},{key:"setLoading",value:function(e){this.isLoading=e}},{key:"setInMemoryToken",value:function(e){this.inMemoryToken=e}},{key:"setPriorutyTab",value:function(e){this.priorityTab=e}},{key:"setShowPreOrders",value:function(e){this.showPreOrders=e}},{key:"login",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var a,r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,St.login(t,n);case 3:a=e.sent,this.setInMemoryToken(a.data.accessToken),this.setUser(a.data.user),this.setAuth(!0),console.log("store",this.inMemoryToken),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(null===(r=e.t0.response)||void 0===r||null===(c=r.data)||void 0===c?void 0:c.message);case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,St.logout();case 3:localStorage.removeItem("token"),this.setAuth(!1),this.setUser({}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(null===(t=e.t0.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"checkAuth",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setLoading(!0),e.prev=1,console.log("check auth request"),e.next=5,Nt.a.get("".concat(kt,"/refresh"),{withCredentials:!0});case 5:return t=e.sent,this.setInMemoryToken(t.data.accessToken),this.setUser(t.data.user),this.setAuth(!0),e.abrupt("return",{isLoaded:!0,isAuth:this.isAuth});case 12:return e.prev=12,e.t0=e.catch(1),console.log(null===(n=e.t0.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.message),e.abrupt("return",{isLoaded:!0,isAuth:this.isAuth});case 16:return e.prev=16,this.setLoading(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[1,12,16,19]])})));return function(){return e.apply(this,arguments)}}()},{key:"uploadFile",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new FormData,t.map((function(e){return n.append("files",e)})),e.next=4,Nt.a.post("".concat("http://localhost:9000/api","/s3/upload"),n,{headers:{"Content-Type":"multipart/form-data"}});case 4:return a=e.sent,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"downloadFile",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,a,r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat("http://localhost:9000/api","/s3/get/").concat(t.Key));case 2:if(200!=(n=e.sent).status){e.next=14;break}return e.next=6,n.blob();case 6:a=e.sent,r=window.URL.createObjectURL(a),(c=document.createElement("a")).href=r,c.download=t.FileName,document.body.appendChild(c),c.click(),c.remove();case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteFile",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Nt.a.get("".concat("http://localhost:9000/api","/s3/delete/").concat(t));case 2:if(200!=e.sent.status){e.next=8;break}return e.next=6,n({variables:{key:t}});case 6:a=e.sent,console.log(a.data);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getPageParams",value:function(e){return this.pageParams.find((function(t){return t.url===e}))}}]),e}(),Pt=(n(307),new _t),Lt=Object(u.createContext)({store:Pt}),Tt=new o.a({uri:"ws://45.10.110.58:8080/v1/graphql",options:{reconnect:!0,lazy:!0,minTimeout:1e3,inactivityTimeout:3e4,connectionCallback:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("gql error. Request new access token"),e.next=3,Pt.checkAuth();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),connectionParams:function(){return{headers:{Authorization:"Bearer ".concat(Pt.inMemoryToken)}}}}}),Ut=new y.ApolloClient({link:Tt,cache:new y.InMemoryCache}),$t=document.getElementById("root");d.a.render(Object(m.jsx)(y.ApolloProvider,{client:Ut,children:Object(m.jsx)(w.a,{children:Object(m.jsx)(xt,{sessionData:$t.dataset.session,children:Object(m.jsx)(Lt.Provider,{value:Pt})})})}),$t),vt()}},[[317,1,2]]]);
//# sourceMappingURL=main.d7973f92.chunk.js.map